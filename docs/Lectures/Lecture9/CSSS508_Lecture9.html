<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>csss508_lecture9</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="http://vsass.github.io" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">CS&amp;SS 508</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Lectures/lectures.html" rel="" target="">
 <span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Homework/homework.html" rel="" target="">
 <span class="menu-text">Homework</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="CSSS508_Lecture9.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">



<section id="title-slide" class="level2" data-menu-title="Iteration" data-background="#1e4655" data-background-image="../../images/csss-logo.png" data-background-position="center top 5%" data-background-size="50%">
<h2 data-menu-title="Iteration" data-background="#1e4655" data-background-image="../../images/csss-logo.png" data-background-position="center top 5%" data-background-size="50%" class="anchored" data-anchor-id="title-slide"></h2>
<p><span class="custom-title">Iteration</span></p>
<p><span class="custom-subtitle">CS&amp;SS 508 • Lecture 9</span></p>
<p><span class="custom-subtitle2">28 November 2023</span></p>
<p><span class="custom-subtitle3">Victoria Sass</span></p>
</section>
<section id="roadmap" class="level1 section-title" data-background-color="#99a486">
<h1 class="section-title" data-background-color="#99a486">Roadmap</h1>
<hr>
<div class="columns">
<div class="column" style="width:50%;">
<p><br></p>
<section id="last-time-we-learned" class="level3">
<h3 class="anchored" data-anchor-id="last-time-we-learned">Last time, we learned:</h3>
<ul>
<li>Function Basics</li>
<li>Types of Functions
<ul>
<li>Vector Functions</li>
<li>Dataframe Functions</li>
<li>Plot Functions</li>
</ul></li>
<li>Function Style Guide</li>
</ul>
</section>
</div><div class="column" style="width:50%;">
<p><br></p>
<div class="fragment">
<section id="today-we-will-cover" class="level3">
<h3 class="anchored" data-anchor-id="today-we-will-cover">Today, we will cover:</h3>
<ul>
<li>Introduction to Iteration</li>
<li>Common Iteration Tasks
<ul>
<li>Modifying Multiple Columns</li>
<li>Reading in Multiple Files</li>
<li>Saving Multiple Outputs</li>
</ul></li>
<li>Base <code>R</code> Equivalents
<ul>
<li>Apply Family</li>
<li><code>for</code> loops</li>
</ul></li>
</ul>
</section>
</div>
</div>
</div>
</section>
<section id="introduction-to-iteration" class="level1 section-title page-columns page-full" data-background-color="#99a486">
<h1 class="section-title" data-background-color="#99a486">Introduction to Iteration</h1>
<section id="bad-repetition" class="level2">
<h2 class="anchored" data-anchor-id="bad-repetition">Bad Repetition</h2>
<p>If someone doesn’t know better, they might find the means of variables in the <code>swiss</code> data by typing a line of code for each column:</p>
<p><br></p>
<div class="cell" data-output-location="fragment">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>mean1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(swiss<span class="sc">$</span>Fertility)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>mean2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(swiss<span class="sc">$</span>Agriculture)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mean3 <span class="ot">&lt;-</span> <span class="fu">mean</span>(swissExamination)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>mean4 <span class="ot">&lt;-</span> <span class="fu">mean</span>(swiss<span class="sc">$</span>Fertility)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>mean5 <span class="ot">&lt;-</span> <span class="fu">mean</span>(swiss<span class="sc">$</span>Catholic)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>mean5 <span class="ot">&lt;-</span> <span class="fu">mean</span>(swiss<span class="sc">$</span>Infant.Mortality)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(mean1, mean2 mean3, mean4, mean5, man6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>&gt; Error: &lt;text&gt;:7:16: unexpected symbol
&gt; 6: mean5 &lt;- mean(swiss$Infant.Mortality)
&gt; 7: c(mean1, mean2 mean3
&gt;                   ^</code></pre>
</div>
</div>
<p><br></p>
<p>Can you spot the problems?</p>
<p>. . .</p>
<p><br></p>
<p>How upset would they be if the <code>swiss</code> data had 200 columns instead of 6?</p>
</section>
<section id="good-repetition" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="good-repetition">Good Repetition</h2>
<p>Today you’ll learn a better way to repeat tasks, <em>without repeating code</em>, using functions from the <code>dplyr</code> and <code>purrr</code> packages in the <code>tidyverse</code>.</p>
<p><br></p>
<div class="cell" data-output-location="fragment">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>swiss <span class="sc">|&gt;</span> <span class="fu">summarize</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">across</span>(Fertility<span class="sc">:</span>Infant.Mortality, mean)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   Fertility Agriculture Examination Education Catholic Infant.Mortality
&gt; 1     70.14       50.66       16.49     10.98    41.14            19.94</code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Don’t worry about the details yet!</p>
</div></div></section>
<section id="goal-dont-repeat-yourself-dry" class="level2">
<h2 class="anchored" data-anchor-id="goal-dont-repeat-yourself-dry">Goal: Don’t Repeat Yourself (DRY)!</h2>
<p>The <strong>DRY</strong> idea: Computers are much better at doing the same thing over and over again than we are.</p>
<div class="incremental">
<ul class="incremental">
<li>Writing code to repeat tasks for us reduces the most common human coding mistakes.</li>
<li>It also <em>substantially</em> reduces the time and effort involved in processing large volumes of data.</li>
<li>Lastly, compact code is more readable and easier to troubleshoot.</li>
</ul>
</div>
</section>
<section id="method-iteration" class="level2">
<h2 class="anchored" data-anchor-id="method-iteration">Method: Iteration!</h2>
<p>Iteration involves repeatedly performing the same action on different objects.</p>
<p>. . .</p>
<p><br></p>
<p>We’ve already done some iteration, both because it’s built into <code>R</code> in certain ways, and because many of the tidyverse packages we’ve used have functions that are iterative.</p>
<p>. . .</p>
<p><br></p>
<section id="some-examples-weve-seen" class="level4">
<h4 class="anchored" data-anchor-id="some-examples-weve-seen">Some examples we’ve seen:</h4>
<div class="incremental">
<ul class="incremental">
<li>Multiplying a vector x by any integer
<ul class="incremental">
<li><em>Other languages require explicit looping but <code>R</code> iterates automatically with its recycling rules</em></li>
</ul></li>
<li>Facetting ggplots</li>
<li>Summarizing a grouped dataset</li>
</ul>
</div>
<p><br></p>
<div class="fragment">
<p>We’re now going to learn what makes <code>R</code> a functional programming language. That is, we’ll learn some functions that themselves take functions as arguments.</p>
</div>
</section>
</section>
</section>
<section id="modifying-multiple-columns" class="level1 section-title" data-background-color="#99a486">
<h1 class="section-title" data-background-color="#99a486">Modifying Multiple Columns</h1>
<section id="simple-motivating-examplecontinued" class="level2">
<h2 class="anchored" data-anchor-id="simple-motivating-examplecontinued">Simple, Motivating Example…Continued</h2>
<p>Let’s return to our first example from last week:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Without our function</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">With our function</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">With <code>across()</code></a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="fragment" data-fragment-index="1">
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 5 × 4
&gt;        a       b      c      d
&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
&gt; 1 -0.130 -0.398   0.347  0.368
&gt; 2 -1.14   1.04   -0.433 -1.07 
&gt; 3 -2.18  -1.06   -0.278 -1.10 
&gt; 4  0.765 -0.0376  0.674 -0.185
&gt; 5 -0.474  1.27    1.25   1.36</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><br></p>
<div class="fragment" data-fragment-index="2">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> (a <span class="sc">-</span> <span class="fu">min</span>(a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">max</span>(a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> (b <span class="sc">-</span> <span class="fu">min</span>(b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">max</span>(b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> (c <span class="sc">-</span> <span class="fu">min</span>(c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">max</span>(c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> (d <span class="sc">-</span> <span class="fu">min</span>(d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">max</span>(d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="fragment" data-fragment-index="3">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rescale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><br></p>
<div class="fragment" data-fragment-index="4">
<div class="columns">
<div class="column" style="width:50%;">
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">a =</span> <span class="fu">rescale01</span>(a),</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">b =</span> <span class="fu">rescale01</span>(b),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">c =</span> <span class="fu">rescale01</span>(c),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">d =</span> <span class="fu">rescale01</span>(d))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 5 × 4
&gt;       a     b      c      d
&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
&gt; 1 0.696 0.284 0.462  0.597 
&gt; 2 0.354 0.902 0      0.0147
&gt; 3 0     0     0.0918 0     
&gt; 4 1     0.439 0.656  0.372 
&gt; 5 0.580 1     1      1</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><br></p>
<div class="fragment" data-fragment-index="5">
<p>Can we make this mutate call <em>even</em> more efficient?</p>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="fragment" data-fragment-index="6">
<div class="cell" data-output-location="fragment">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(a<span class="sc">:</span>d, rescale01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 5 × 4
&gt;       a     b      c      d
&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
&gt; 1 0.696 0.284 0.462  0.597 
&gt; 2 0.354 0.902 0      0.0147
&gt; 3 0     0     0.0918 0     
&gt; 4 1     0.439 0.656  0.372 
&gt; 5 0.580 1     1      1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="basics-of-across" class="level2">
<h2 class="anchored" data-anchor-id="basics-of-across">Basics of <code>across()</code></h2>
<p><code>across()</code> makes it easy to apply the same transformation to multiple columns.</p>
<p>. . .</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(.cols, .fns, <span class="at">.names =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p><br></p>
<p>There are three particularly important arguments, the first two of which you’ll use in every call to <code>across()</code>.</p>
<div class="incremental">
<ul class="incremental">
<li><code>.cols</code> specifies which columns to iterate over.</li>
<li><code>.fns</code> specifies what to do with each column.</li>
<li><code>.names</code> specifies the names of the output columns.</li>
</ul>
</div>
</section>
<section id="reading-in-columns-with-.cols" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-columns-with-.cols">Reading in columns with <code>.cols</code></h2>
<p><code>.cols</code> uses the same specifications as <code>select()</code> so you can use <code>tidyselect</code> functions like <code>starts_with()</code> to select columns based on their name.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Sepal"</span>), median))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   Sepal.Length Sepal.Width
&gt; 1          5.8           3</code></pre>
</div>
</div>
<p>. . .</p>
<p>You can also use <code>everything()</code> which selects every (non-grouping) column.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), median), </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;      Species Sepal.Length Sepal.Width Petal.Length Petal.Width
&gt; 1     setosa          5.0         3.4         1.50         0.2
&gt; 2 versicolor          5.9         2.8         4.35         1.3
&gt; 3  virginica          6.5         3.0         5.55         2.0</code></pre>
</div>
</div>
<p>. . .</p>
<p>Lastly, <code>where()</code> allows you to select columns based on their type.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-6"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-6-1"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-6-2" class="code-annotation-target"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), median))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-6" data-code-annotation="1">Just like other selectors, you can combine these with Boolean algebra. For example, <code>!where(is.numeric)</code> selects all non-numeric columns.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width
&gt; 1          5.8           3         4.35         1.3</code></pre>
</div>
</div>
</section>
<section id="calling-a-single-function" class="level2">
<h2 class="anchored" data-anchor-id="calling-a-single-function">Calling a single function</h2>
<p>The second argument to <code>across()</code> is what makes <code>R</code> a functional programming language. Here we’re passing a function to another function.</p>
<p>. . .</p>
<p><br></p>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:red"><i class="fa-solid fa-circle-exclamation" aria-label="circle-exclamation"></i></span> Important Distinction
</div>
</div>
<div class="callout-body-container callout-body">
<p>We’re passing this function to <code>across()</code>, so <code>across()</code> can call it; we’re not calling it ourselves. That means the function name should never be followed by <code>()</code>. If you forget, you’ll get an error:</p>
</div>
</div>
<p>. . .</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-7-2" class="code-annotation-target"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(Ozone<span class="sc">:</span>Temp, <span class="fu">median</span>()))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-7" data-code-annotation="2">This error arises because you’re calling the function with no input, <code>i.e. median()</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-error">
<pre><code>&gt; Error in `summarise()`:
&gt; ℹ In argument: `across(Ozone:Temp, median())`.
&gt; Caused by error in `median.default()`:
&gt; ! argument "x" is missing, with no default</code></pre>
</div>
</div>
</section>
<section id="anonymous-functions" class="level2">
<h2 class="anchored" data-anchor-id="anonymous-functions">Anonymous Functions</h2>
<p>If the function you pass to <code>across()</code> has its own arguments that you want to specify, you’ll need to use an anonymous function:</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-8"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-8-1"><a href="#annotated-cell-8-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-8-2" class="code-annotation-target"><a href="#annotated-cell-8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(Ozone<span class="sc">:</span>Temp, \(x) <span class="fu">median</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-8" data-code-annotation="3">So-called anonymous, because we never explicitly gave it a name with <code>&lt;-</code>. Another term programmers use for this is “lambda function”.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   Ozone Solar.R Wind Temp
&gt; 1  31.5     205  9.7   79</code></pre>
</div>
</div>
<p>. . .</p>
<p><br></p>
<p>You might also see older code that looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-9-1"><a href="#annotated-cell-9-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-9-2" class="code-annotation-target"><a href="#annotated-cell-9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(Ozone<span class="sc">:</span>Temp, <span class="sc">~</span> <span class="fu">median</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-9" data-code-annotation="4">This is another way to write anonymous functions but it only works inside tidyverse functions and always uses the variable name <code>.x</code>. Base syntax is now recommended (i.e.&nbsp;<code>\(x) x + 1</code>).</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   Ozone Solar.R Wind Temp
&gt; 1  31.5     205  9.7   79</code></pre>
</div>
</div>
</section>
<section id="calling-multiple-functions" class="level2">
<h2 class="anchored" data-anchor-id="calling-multiple-functions">Calling multiple functions</h2>
<p>What if we want to know how many missing values we removed, in addition to calculating the median without those values?</p>
<p>. . .</p>
<p>If you need to call multiple functions within <code>across()</code>, you’ll need to turn them into a named list.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-10-1"><a href="#annotated-cell-10-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(Ozone<span class="sc">:</span>Temp, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-10-3" class="code-annotation-target"><a href="#annotated-cell-10-3" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(<span class="at">median =</span> \(x) <span class="fu">median</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_miss =</span> \(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="5">5</dt>
<dd>
<span data-code-lines="3,4" data-code-cell="annotated-cell-10" data-code-annotation="5">The names of the list are used to name the new variables. In fact, the columns are named using a glue specification <code>{.col}_{.fn}</code> where <code>.col</code> is the name of the original column and <code>.fn</code> is the name of the function.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   Ozone_median Ozone_n_miss Solar.R_median Solar.R_n_miss Wind_median
&gt; 1         31.5           37            205              7         9.7
&gt;   Wind_n_miss Temp_median Temp_n_miss
&gt; 1           0          79           0</code></pre>
</div>
</div>
</section>
<section id="column-names" class="level2">
<h2 class="anchored" data-anchor-id="column-names">Column Names</h2>
<p>By default, the output of <code>across()</code> is given the same names as the inputs. This means that <code>across()</code> inside of mutate() will replace existing columns.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(a<span class="sc">:</span>d, rescale01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 5 × 4
&gt;       a     b      c      d
&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
&gt; 1 0.696 0.284 0.462  0.597 
&gt; 2 0.354 0.902 0      0.0147
&gt; 3 0     0     0.0918 0     
&gt; 4 1     0.439 0.656  0.372 
&gt; 5 0.580 1     1      1</code></pre>
</div>
</div>
<p>. . .</p>
<p>If you’d like to instead create new columns, you can use the <code>.names</code> argument to give the output new names.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-12-1" class="code-annotation-target"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(a<span class="sc">:</span>d, rescale01, <span class="at">.names =</span> <span class="st">"{.col}_rescaled"</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="6">6</dt>
<dd>
<span data-code-lines="1" data-code-cell="annotated-cell-12" data-code-annotation="6"><code>.col</code> simply represents the original variable name.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 5 × 8
&gt;        a       b      c      d a_rescaled b_rescaled c_rescaled d_rescaled
&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
&gt; 1 -0.130 -0.398   0.347  0.368      0.696      0.284     0.462      0.597 
&gt; 2 -1.14   1.04   -0.433 -1.07       0.354      0.902     0          0.0147
&gt; 3 -2.18  -1.06   -0.278 -1.10       0          0         0.0918     0     
&gt; 4  0.765 -0.0376  0.674 -0.185      1          0.439     0.656      0.372 
&gt; 5 -0.474  1.27    1.25   1.36       0.580      1         1          1</code></pre>
</div>
</div>
</section>
<section id="if_any-and-if_all" class="level2">
<h2 class="anchored" data-anchor-id="if_any-and-if_all"><code>if_any()</code> and <code>if_all()</code></h2>
<p><code>across()</code> works well with <code>mutate()</code> and <code>summarize()</code> but it has two variants that work with <code>filter()</code>.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-13-1" class="code-annotation-target"><a href="#annotated-cell-13-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">if_any</span>(Ozone<span class="sc">:</span>Temp, is.na))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="7">7</dt>
<dd>
<span data-code-lines="1" data-code-cell="annotated-cell-13" data-code-annotation="7">This is the same as <code>airquality |&gt; filter(is.na(Ozone) | is.na(Solar.R) | is.na(Wind) | is.na(Temp))</code></span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;    Ozone Solar.R Wind Temp Month Day
&gt; 1     NA      NA 14.3   56     5   5
&gt; 2     28      NA 14.9   66     5   6
&gt; 3     NA     194  8.6   69     5  10
&gt; 4      7      NA  6.9   74     5  11
&gt; 5     NA      66 16.6   57     5  25
&gt; 6     NA     266 14.9   58     5  26
&gt; 7     NA      NA  8.0   57     5  27
&gt; 8     NA     286  8.6   78     6   1
&gt; 9     NA     287  9.7   74     6   2
&gt; 10    NA     242 16.1   67     6   3
&gt; 11    NA     186  9.2   84     6   4
&gt; 12    NA     220  8.6   85     6   5
&gt; 13    NA     264 14.3   79     6   6
&gt; 14    NA     273  6.9   87     6   8
&gt; 15    NA     259 10.9   93     6  11
&gt; 16    NA     250  9.2   92     6  12
&gt; 17    NA     332 13.8   80     6  14
&gt; 18    NA     322 11.5   79     6  15
&gt; 19    NA     150  6.3   77     6  21
&gt; 20    NA      59  1.7   76     6  22
&gt; 21    NA      91  4.6   76     6  23
&gt; 22    NA     250  6.3   76     6  24
&gt; 23    NA     135  8.0   75     6  25
&gt; 24    NA     127  8.0   78     6  26
&gt; 25    NA      47 10.3   73     6  27
&gt; 26    NA      98 11.5   80     6  28
&gt; 27    NA      31 14.9   77     6  29
&gt; 28    NA     138  8.0   83     6  30
&gt; 29    NA     101 10.9   84     7   4
&gt; 30    NA     139  8.6   82     7  11
&gt; 31    NA     291 14.9   91     7  14
&gt; 32    NA     258  9.7   81     7  22
&gt; 33    NA     295 11.5   82     7  23
&gt; 34    78      NA  6.9   86     8   4
&gt; 35    35      NA  7.4   85     8   5
&gt; 36    66      NA  4.6   87     8   6
&gt; 37    NA     222  8.6   92     8  10
&gt; 38    NA     137 11.5   86     8  11
&gt; 39    NA      64 11.5   79     8  15
&gt; 40    NA     255 12.6   75     8  23
&gt; 41    NA     153  5.7   88     8  27
&gt; 42    NA     145 13.2   77     9  27</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="8" onclick="event.preventDefault();">8</a><span id="annotated-cell-14-1" class="code-annotation-target"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">if_all</span>(Ozone<span class="sc">:</span>Temp, is.na))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="8">8</dt>
<dd>
<span data-code-lines="1" data-code-cell="annotated-cell-14" data-code-annotation="8">This is the same as <code>airquality |&gt; filter(is.na(Ozone) &amp; is.na(Solar.R) &amp; is.na(Wind) &amp; is.na(Temp))</code></span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] Ozone   Solar.R Wind    Temp    Month   Day    
&gt; &lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
</section>
<section id="across-in-functions" class="level2">
<h2 class="anchored" data-anchor-id="across-in-functions"><code>across()</code> in Functions</h2>
<p>Naturally, <code>across()</code> lends itself to functions because it allows you to operate on multiple columns simultaneously.</p>
<p>. . .</p>
<p>Just remember to embrace with <code>{{ }}</code> when using an argument for column selection since the first argument of <code>across()</code> uses the tidy evaluation method tidy-select.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>summarize_means <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">summary_vars =</span> <span class="fu">where</span>(is.numeric)) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>({{ summary_vars }}, \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<div class="columns">
<div class="column" style="width:45%;">
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cut) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_means</span>(<span class="fu">c</span>(carat, x<span class="sc">:</span>z))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:55%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 5 × 6
&gt;   cut       carat     x     y     z     n
&gt;   &lt;ord&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
&gt; 1 Fair      1.05   6.25  6.18  3.98  1610
&gt; 2 Good      0.849  5.84  5.85  3.64  4906
&gt; 3 Very Good 0.806  5.74  5.77  3.56 12082
&gt; 4 Premium   0.892  5.97  5.94  3.65 13791
&gt; 5 Ideal     0.703  5.51  5.52  3.40 21551</code></pre>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="section" class="level1 section-title" data-menu-title="`purrr``" data-background-image="images/purrr.png" data-background-size="contain" data-background-position="center" data-background-color="#1e4655">
<h1 class="section-title" data-menu-title="`purrr``" data-background-image="images/purrr.png" data-background-size="contain" data-background-position="center" data-background-color="#1e4655"></h1>
</section>
<section id="reading-in-multiple-files" class="level1 section-title" data-background-color="#99a486">
<h1 class="section-title" data-background-color="#99a486">Reading in Multiple Files</h1>
<section id="bad-repetition-redux" class="level2">
<h2 class="anchored" data-anchor-id="bad-repetition-redux">Bad repetition redux</h2>
<p>Imagine you have a directory full of excel spreadsheets you want to read into <code>R</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>data2019 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/y2019.xlsx"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>data2020 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/y2020.xlsx"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>data2021 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/y2021.xlsx"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>data2022 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/y2022.xlsx"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(data2019, data2020, data2021, data2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You could <em>technically</em> do it with copy and paste but we know that that’s probably not the most efficient, least error-prone approach.</p>
<p>. . .</p>
<p>Not to mention how inconvenient this would be if you had hundreds of files to read in and combine.</p>
<p>. . .</p>
<p>The <strong>iterative approach</strong> involves three broad steps:</p>
<div class="incremental">
<ul class="incremental">
<li>use <code>list.files()</code> to list all the files in a directory</li>
<li>use <code>purrr::map()</code> to read each of them into a list</li>
<li>use <code>purrr::list_rbind()</code> to combine them into a single data frame</li>
</ul>
</div>
</section>
<section id="step-1-listing-files-in-a-directory" class="level2">
<h2 class="anchored" data-anchor-id="step-1-listing-files-in-a-directory">Step 1: Listing Files in a Directory</h2>
<p>The first part of this method involves creating a character vector of all the file paths for the files you want to read in. We’ll motivate this example by reading in the gapminder data that’s saved in separate excel sheets by year in my working directory.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-17"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-17-1" class="code-annotation-target"><a href="#annotated-cell-17-1" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"data/gapminder"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-17-2" class="code-annotation-target"><a href="#annotated-cell-17-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pattern =</span> <span class="st">"[.]xlsx$"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-17-3" class="code-annotation-target"><a href="#annotated-cell-17-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="annotated-cell-17-4"><a href="#annotated-cell-17-4" aria-hidden="true" tabindex="-1"></a>paths</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1" data-code-cell="annotated-cell-17" data-code-annotation="1">The first argument, <code>path</code>, is the directory to look within.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-17" data-code-annotation="2"><code>pattern</code> is a regular expression used to filter the file names. The most common pattern is something like <code>[.]xlsx$</code> or <code>[.]csv$</code> to find all files with a specified extension.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="3" data-code-cell="annotated-cell-17" data-code-annotation="3"><code>full.names</code> determines whether or not the directory name should be included in the output. You almost always want this to be <code>TRUE.</code></span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;  [1] "data/gapminder/1952.xlsx" "data/gapminder/1957.xlsx"
&gt;  [3] "data/gapminder/1962.xlsx" "data/gapminder/1967.xlsx"
&gt;  [5] "data/gapminder/1972.xlsx" "data/gapminder/1977.xlsx"
&gt;  [7] "data/gapminder/1982.xlsx" "data/gapminder/1987.xlsx"
&gt;  [9] "data/gapminder/1992.xlsx" "data/gapminder/1997.xlsx"
&gt; [11] "data/gapminder/2002.xlsx" "data/gapminder/2007.xlsx"</code></pre>
</div>
</div>
</section>
<section id="reading-files-into-a-list" class="level2">
<h2 class="anchored" data-anchor-id="reading-files-into-a-list">Reading Files into a List</h2>
<p>Now we want to read these excel sheets into a single object so we can use iteration in the next step! A list is the perfect tool for this.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1952.xlsx"</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1957.xlsx"</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1962.xlsx"</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1967.xlsx"</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1972.xlsx"</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1977.xlsx"</span>),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1982.xlsx"</span>),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1987.xlsx"</span>),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1992.xlsx"</span>),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1997.xlsx"</span>),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/2002.xlsx"</span>),</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/2007.xlsx"</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>Unfortunately, this is just as tedious a method as reading in all the separate file paths and creating individual data frame objects!</p>
</section>
<section id="step-2-using-map-instead" class="level2">
<h2 class="anchored" data-anchor-id="step-2-using-map-instead">Step 2: Using <code>map()</code> instead!</h2>
<p>Instead of listing out all the <code>read_excel()</code> calls in our list, we can used the <code>map()</code> function from the tidyverse’s <code>purrr</code> package. <code>map()</code> is similar to <code>across()</code>, but instead of doing something to each column in a data frame, it does something to each element of a vector.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">map</span>(paths, readxl<span class="sc">::</span>read_excel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>Now, what does <code>files</code> contain?</p>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>files[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:70%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp      pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         28.8  8425333      779.
&gt;  2 Albania     Europe       55.2  1282697     1601.
&gt;  3 Algeria     Africa       43.1  9279525     2449.
&gt;  4 Angola      Africa       30.0  4232095     3521.
&gt;  5 Argentina   Americas     62.5 17876956     5911.
&gt;  6 Australia   Oceania      69.1  8691212    10040.
&gt;  7 Austria     Europe       66.8  6927772     6137.
&gt;  8 Bahrain     Asia         50.9   120447     9867.
&gt;  9 Bangladesh  Asia         37.5 46886859      684.
&gt; 10 Belgium     Europe       68    8730405     8343.
&gt; # ℹ 132 more rows</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="step-3-combine-dataframes-into-one" class="level2">
<h2 class="anchored" data-anchor-id="step-3-combine-dataframes-into-one">Step 3: Combine Dataframes into One</h2>
<p>Now that we have all our individual dataframes in an element of a list, we can use <code>list_rbind</code> to combine them into one dataframe.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_rbind</span>(files)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 1,704 × 5
&gt;    country     continent lifeExp      pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         28.8  8425333      779.
&gt;  2 Albania     Europe       55.2  1282697     1601.
&gt;  3 Algeria     Africa       43.1  9279525     2449.
&gt;  4 Angola      Africa       30.0  4232095     3521.
&gt;  5 Argentina   Americas     62.5 17876956     5911.
&gt;  6 Australia   Oceania      69.1  8691212    10040.
&gt;  7 Austria     Europe       66.8  6927772     6137.
&gt;  8 Bahrain     Asia         50.9   120447     9867.
&gt;  9 Bangladesh  Asia         37.5 46886859      684.
&gt; 10 Belgium     Europe       68    8730405     8343.
&gt; # ℹ 1,694 more rows</code></pre>
</div>
</div>
<p>. . .</p>
<p>The super efficient, full code for the last two steps would therefore be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>paths <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(readxl<span class="sc">::</span>read_excel) <span class="sc">|&gt;</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-in-the-filepath" class="level2">
<h2 class="anchored" data-anchor-id="data-in-the-filepath">Data in the Filepath</h2>
<p>You may have noticed that we’re missing a year indicator in our final dataset. That’s because that information is actually a part of the filename itself.</p>
<p>. . .</p>
<p>There’s a way to include the filename in the data but we have to add another step to our <code>paths</code> pipeline:</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-22"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-22-1"><a href="#annotated-cell-22-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> paths <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-22" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-22-2" class="code-annotation-target"><a href="#annotated-cell-22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(basename) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-22-3"><a href="#annotated-cell-22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(readxl<span class="sc">::</span>read_excel)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-22" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-22" data-code-annotation="4">The <code>set_names</code> function takes the function <code>basename</code> which extracts just the file name from the full path. This line of code will therefore create a named vector of the file paths where the names are actually the filenames.</span>
</dd>
</dl>
</div>
</div>
<p>. . .</p>
<p>What is this doing?</p>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>paths <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(basename)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:70%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&gt;                  1952.xlsx                  1957.xlsx 
&gt; "data/gapminder/1952.xlsx" "data/gapminder/1957.xlsx" 
&gt;                  1962.xlsx                  1967.xlsx 
&gt; "data/gapminder/1962.xlsx" "data/gapminder/1967.xlsx" 
&gt;                  1972.xlsx                  1977.xlsx 
&gt; "data/gapminder/1972.xlsx" "data/gapminder/1977.xlsx" 
&gt;                  1982.xlsx                  1987.xlsx 
&gt; "data/gapminder/1982.xlsx" "data/gapminder/1987.xlsx" 
&gt;                  1992.xlsx                  1997.xlsx 
&gt; "data/gapminder/1992.xlsx" "data/gapminder/1997.xlsx" 
&gt;                  2002.xlsx                  2007.xlsx 
&gt; "data/gapminder/2002.xlsx" "data/gapminder/2007.xlsx"</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="data-in-the-filepath-1" class="level2">
<h2 class="anchored" data-anchor-id="data-in-the-filepath-1">Data in the Filepath</h2>
<p>You may have noticed that we’re missing a year indicator in our final dataset. That’s because that information is actually a part of the filename itself.</p>
<p>There’s a way to include the filename in the data but we have to add another step to our <code>paths</code> pipeline:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-23"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-23-1"><a href="#annotated-cell-23-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> paths <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-23-2" class="code-annotation-target"><a href="#annotated-cell-23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(basename) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-23-3"><a href="#annotated-cell-23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(readxl<span class="sc">::</span>read_excel)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-23" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-23" data-code-annotation="4">The <code>set_names</code> function takes the function <code>basename</code> which extracts just the file name from the full path. This line of code will therefore create a named vector of the file paths where the names are actually the filenames.</span>
</dd>
</dl>
</div>
</div>
<p>What is this doing?</p>
<div class="columns">
<div class="column" style="width:35%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>paths <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(basename) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(readxl<span class="sc">::</span>read_excel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:65%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&gt; $`1952.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp      pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         28.8  8425333      779.
&gt;  2 Albania     Europe       55.2  1282697     1601.
&gt;  3 Algeria     Africa       43.1  9279525     2449.
&gt;  4 Angola      Africa       30.0  4232095     3521.
&gt;  5 Argentina   Americas     62.5 17876956     5911.
&gt;  6 Australia   Oceania      69.1  8691212    10040.
&gt;  7 Austria     Europe       66.8  6927772     6137.
&gt;  8 Bahrain     Asia         50.9   120447     9867.
&gt;  9 Bangladesh  Asia         37.5 46886859      684.
&gt; 10 Belgium     Europe       68    8730405     8343.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`1957.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp      pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         30.3  9240934      821.
&gt;  2 Albania     Europe       59.3  1476505     1942.
&gt;  3 Algeria     Africa       45.7 10270856     3014.
&gt;  4 Angola      Africa       32.0  4561361     3828.
&gt;  5 Argentina   Americas     64.4 19610538     6857.
&gt;  6 Australia   Oceania      70.3  9712569    10950.
&gt;  7 Austria     Europe       67.5  6965860     8843.
&gt;  8 Bahrain     Asia         53.8   138655    11636.
&gt;  9 Bangladesh  Asia         39.3 51365468      662.
&gt; 10 Belgium     Europe       69.2  8989111     9715.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`1962.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp      pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         32.0 10267083      853.
&gt;  2 Albania     Europe       64.8  1728137     2313.
&gt;  3 Algeria     Africa       48.3 11000948     2551.
&gt;  4 Angola      Africa       34    4826015     4269.
&gt;  5 Argentina   Americas     65.1 21283783     7133.
&gt;  6 Australia   Oceania      70.9 10794968    12217.
&gt;  7 Austria     Europe       69.5  7129864    10751.
&gt;  8 Bahrain     Asia         56.9   171863    12753.
&gt;  9 Bangladesh  Asia         41.2 56839289      686.
&gt; 10 Belgium     Europe       70.2  9218400    10991.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`1967.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp      pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         34.0 11537966      836.
&gt;  2 Albania     Europe       66.2  1984060     2760.
&gt;  3 Algeria     Africa       51.4 12760499     3247.
&gt;  4 Angola      Africa       36.0  5247469     5523.
&gt;  5 Argentina   Americas     65.6 22934225     8053.
&gt;  6 Australia   Oceania      71.1 11872264    14526.
&gt;  7 Austria     Europe       70.1  7376998    12835.
&gt;  8 Bahrain     Asia         59.9   202182    14805.
&gt;  9 Bangladesh  Asia         43.5 62821884      721.
&gt; 10 Belgium     Europe       70.9  9556500    13149.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`1972.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp      pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         36.1 13079460      740.
&gt;  2 Albania     Europe       67.7  2263554     3313.
&gt;  3 Algeria     Africa       54.5 14760787     4183.
&gt;  4 Angola      Africa       37.9  5894858     5473.
&gt;  5 Argentina   Americas     67.1 24779799     9443.
&gt;  6 Australia   Oceania      71.9 13177000    16789.
&gt;  7 Austria     Europe       70.6  7544201    16662.
&gt;  8 Bahrain     Asia         63.3   230800    18269.
&gt;  9 Bangladesh  Asia         45.3 70759295      630.
&gt; 10 Belgium     Europe       71.4  9709100    16672.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`1977.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp      pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         38.4 14880372      786.
&gt;  2 Albania     Europe       68.9  2509048     3533.
&gt;  3 Algeria     Africa       58.0 17152804     4910.
&gt;  4 Angola      Africa       39.5  6162675     3009.
&gt;  5 Argentina   Americas     68.5 26983828    10079.
&gt;  6 Australia   Oceania      73.5 14074100    18334.
&gt;  7 Austria     Europe       72.2  7568430    19749.
&gt;  8 Bahrain     Asia         65.6   297410    19340.
&gt;  9 Bangladesh  Asia         46.9 80428306      660.
&gt; 10 Belgium     Europe       72.8  9821800    19118.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`1982.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp      pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         39.9 12881816      978.
&gt;  2 Albania     Europe       70.4  2780097     3631.
&gt;  3 Algeria     Africa       61.4 20033753     5745.
&gt;  4 Angola      Africa       39.9  7016384     2757.
&gt;  5 Argentina   Americas     69.9 29341374     8998.
&gt;  6 Australia   Oceania      74.7 15184200    19477.
&gt;  7 Austria     Europe       73.2  7574613    21597.
&gt;  8 Bahrain     Asia         69.1   377967    19211.
&gt;  9 Bangladesh  Asia         50.0 93074406      677.
&gt; 10 Belgium     Europe       73.9  9856303    20980.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`1987.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp       pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         40.8  13867957      852.
&gt;  2 Albania     Europe       72     3075321     3739.
&gt;  3 Algeria     Africa       65.8  23254956     5681.
&gt;  4 Angola      Africa       39.9   7874230     2430.
&gt;  5 Argentina   Americas     70.8  31620918     9140.
&gt;  6 Australia   Oceania      76.3  16257249    21889.
&gt;  7 Austria     Europe       74.9   7578903    23688.
&gt;  8 Bahrain     Asia         70.8    454612    18524.
&gt;  9 Bangladesh  Asia         52.8 103764241      752.
&gt; 10 Belgium     Europe       75.4   9870200    22526.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`1992.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp       pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         41.7  16317921      649.
&gt;  2 Albania     Europe       71.6   3326498     2497.
&gt;  3 Algeria     Africa       67.7  26298373     5023.
&gt;  4 Angola      Africa       40.6   8735988     2628.
&gt;  5 Argentina   Americas     71.9  33958947     9308.
&gt;  6 Australia   Oceania      77.6  17481977    23425.
&gt;  7 Austria     Europe       76.0   7914969    27042.
&gt;  8 Bahrain     Asia         72.6    529491    19036.
&gt;  9 Bangladesh  Asia         56.0 113704579      838.
&gt; 10 Belgium     Europe       76.5  10045622    25576.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`1997.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp       pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         41.8  22227415      635.
&gt;  2 Albania     Europe       73.0   3428038     3193.
&gt;  3 Algeria     Africa       69.2  29072015     4797.
&gt;  4 Angola      Africa       41.0   9875024     2277.
&gt;  5 Argentina   Americas     73.3  36203463    10967.
&gt;  6 Australia   Oceania      78.8  18565243    26998.
&gt;  7 Austria     Europe       77.5   8069876    29096.
&gt;  8 Bahrain     Asia         73.9    598561    20292.
&gt;  9 Bangladesh  Asia         59.4 123315288      973.
&gt; 10 Belgium     Europe       77.5  10199787    27561.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`2002.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp       pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         42.1  25268405      727.
&gt;  2 Albania     Europe       75.7   3508512     4604.
&gt;  3 Algeria     Africa       71.0  31287142     5288.
&gt;  4 Angola      Africa       41.0  10866106     2773.
&gt;  5 Argentina   Americas     74.3  38331121     8798.
&gt;  6 Australia   Oceania      80.4  19546792    30688.
&gt;  7 Austria     Europe       79.0   8148312    32418.
&gt;  8 Bahrain     Asia         74.8    656397    23404.
&gt;  9 Bangladesh  Asia         62.0 135656790     1136.
&gt; 10 Belgium     Europe       78.3  10311970    30486.
&gt; # ℹ 132 more rows
&gt; 
&gt; $`2007.xlsx`
&gt; # A tibble: 142 × 5
&gt;    country     continent lifeExp       pop gdpPercap
&gt;    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1 Afghanistan Asia         43.8  31889923      975.
&gt;  2 Albania     Europe       76.4   3600523     5937.
&gt;  3 Algeria     Africa       72.3  33333216     6223.
&gt;  4 Angola      Africa       42.7  12420476     4797.
&gt;  5 Argentina   Americas     75.3  40301927    12779.
&gt;  6 Australia   Oceania      81.2  20434176    34435.
&gt;  7 Austria     Europe       79.8   8199783    36126.
&gt;  8 Bahrain     Asia         75.6    708573    29796.
&gt;  9 Bangladesh  Asia         64.1 150448339     1391.
&gt; 10 Belgium     Europe       79.4  10392226    33693.
&gt; # ℹ 132 more rows</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="data-in-the-filepath-2" class="level2">
<h2 class="anchored" data-anchor-id="data-in-the-filepath-2">Data in the Filepath</h2>
<p>To create a <code>year</code> variable we need to tell <code>list_rbind</code> to save the filename information.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-24"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-24-1"><a href="#annotated-cell-24-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="ot">&lt;-</span> paths <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-24-2"><a href="#annotated-cell-24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(basename) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-24-3"><a href="#annotated-cell-24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(readxl<span class="sc">::</span>read_excel) <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-24-4" class="code-annotation-target"><a href="#annotated-cell-24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>(<span class="at">names_to =</span> <span class="st">"year"</span>) <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-24-5" class="code-annotation-target"><a href="#annotated-cell-24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">parse_number</span>(year))</span>
<span id="annotated-cell-24-6"><a href="#annotated-cell-24-6" aria-hidden="true" tabindex="-1"></a>gapminder</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-24" data-target-annotation="5">5</dt>
<dd>
<span data-code-lines="4" data-code-cell="annotated-cell-24" data-code-annotation="5">The name of each list element (the filename) will be saved as the variable <code>year</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="6">6</dt>
<dd>
<span data-code-lines="5" data-code-cell="annotated-cell-24" data-code-annotation="6">Extracting just the numeric part of the filename which is the actual year.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 1,704 × 6
&gt;     year country     continent lifeExp      pop gdpPercap
&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
&gt;  1  1952 Afghanistan Asia         28.8  8425333      779.
&gt;  2  1952 Albania     Europe       55.2  1282697     1601.
&gt;  3  1952 Algeria     Africa       43.1  9279525     2449.
&gt;  4  1952 Angola      Africa       30.0  4232095     3521.
&gt;  5  1952 Argentina   Americas     62.5 17876956     5911.
&gt;  6  1952 Australia   Oceania      69.1  8691212    10040.
&gt;  7  1952 Austria     Europe       66.8  6927772     6137.
&gt;  8  1952 Bahrain     Asia         50.9   120447     9867.
&gt;  9  1952 Bangladesh  Asia         37.5 46886859      684.
&gt; 10  1952 Belgium     Europe       68    8730405     8343.
&gt; # ℹ 1,694 more rows</code></pre>
</div>
</div>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-25"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-25-1" class="code-annotation-target"><a href="#annotated-cell-25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(gapminder, <span class="st">"gapminder.csv"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-25" data-target-annotation="7">7</dt>
<dd>
<span data-code-lines="1" data-code-cell="annotated-cell-25" data-code-annotation="7">Be sure to save your work so you can simply read in one file when working on this project in the future!</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="more-complex-cases" class="level2">
<h2 class="anchored" data-anchor-id="more-complex-cases">More Complex Cases</h2>
<p>. . .</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:blue"><i class="fa-solid fa-circle-info" aria-label="circle-info"></i></span> Complicated Filenames
</div>
</div>
<div class="callout-body-container callout-body">
<p>There might be other variables stored in the directory name, or maybe the file name contains multiple bits of data. In that case, use <code>set_names()</code> (without any arguments) to record the full path, and then use <code>separate_wider_delim()</code> and friends to turn them into useful columns. See example at the end of <a href="https://r4ds.hadley.nz/iteration#sec-data-in-the-path">this section</a>.</p>
</div>
</div>
<p>. . .</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:green"><i class="fa-solid fa-circle-info" aria-label="circle-info"></i></span> Untidy data of the same structure
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can use <code>map</code> many times to perform different tidying and data manipulation tasks before combining datasets. Alternatively you can <code>list_rbind</code> first and then perform data manipulation tasks using a standard <code>dplyr</code> approach. See examples <a href="https://r4ds.hadley.nz/iteration#many-simple-iterations">here</a>.</p>
</div>
</div>
<p>. . .</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:tomato"><i class="fa-solid fa-circle-info" aria-label="circle-info"></i></span> Heterogenous data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Read <a href="https://r4ds.hadley.nz/iteration#heterogeneous-data">this section</a> of <em>“R for Data Science”</em></p>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:red"><i class="fa-solid fa-circle-info" aria-label="circle-info"></i></span> Troubleshooting
</div>
</div>
<div class="callout-body-container callout-body">
<p>Read <a href="https://r4ds.hadley.nz/iteration#handling-failures">this section</a> of <em>“R for Data Science”</em></p>
</div>
</div>
</section>
</section>
<section id="saving-multiple-outputs" class="level1 section-title" data-background-color="#99a486">
<h1 class="section-title" data-background-color="#99a486">Saving Multiple Outputs</h1>
<section id="writing-multiple-csv-files" class="level2">
<h2 class="anchored" data-anchor-id="writing-multiple-csv-files">Writing multiple csv files</h2>
<p>Let’s imagine we want to save multiple datasets based on a feature of the data.</p>
<p>. . .</p>
<p>For example, what if we want a different csv for each <code>clarity</code> type in the <code>diamonds</code> dataset?</p>
<p>. . .</p>
<p>The easiest way to make these individual datasets is using <code>group_nest()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-26"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-26-1"><a href="#annotated-cell-26-1" aria-hidden="true" tabindex="-1"></a>by_clarity <span class="ot">&lt;-</span> diamonds <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-26-2" class="code-annotation-target"><a href="#annotated-cell-26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_nest</span>(clarity) <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-26-3" class="code-annotation-target"><a href="#annotated-cell-26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">path =</span> <span class="fu">str_glue</span>(<span class="st">"diamonds-{clarity}.csv"</span>))</span>
<span id="annotated-cell-26-4"><a href="#annotated-cell-26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-5"><a href="#annotated-cell-26-5" aria-hidden="true" tabindex="-1"></a>by_clarity</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-26" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-26" data-code-annotation="1">Nests a tibble using a grouping specification.</span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="3" data-code-cell="annotated-cell-26" data-code-annotation="2">Creates a column that gives the name of output file.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 8 × 3
&gt;   clarity               data path             
&gt;   &lt;ord&gt;   &lt;list&lt;tibble[,9]&gt;&gt; &lt;glue&gt;           
&gt; 1 I1               [741 × 9] diamonds-I1.csv  
&gt; 2 SI2            [9,194 × 9] diamonds-SI2.csv 
&gt; 3 SI1           [13,065 × 9] diamonds-SI1.csv 
&gt; 4 VS2           [12,258 × 9] diamonds-VS2.csv 
&gt; 5 VS1            [8,171 × 9] diamonds-VS1.csv 
&gt; 6 VVS2           [5,066 × 9] diamonds-VVS2.csv
&gt; 7 VVS1           [3,655 × 9] diamonds-VVS1.csv
&gt; 8 IF             [1,790 × 9] diamonds-IF.csv</code></pre>
</div>
</div>
</section>
<section id="writing-multiple-csv-files-1" class="level2">
<h2 class="anchored" data-anchor-id="writing-multiple-csv-files-1">Writing multiple csv files</h2>
<p>Let’s imagine we want to save multiple datasets based on a feature of the data.</p>
<p>For example, what if we want a different csv for each <code>clarity</code> type in the <code>diamonds</code> dataset?</p>
<p>The easiest way to make these individual datasets is using <code>group_nest()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>by_clarity<span class="sc">$</span>data[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 741 × 9
&gt;    carat cut       color depth table price     x     y     z
&gt;    &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
&gt;  1  0.32 Premium   E      60.9    58   345  4.38  4.42  2.68
&gt;  2  1.17 Very Good J      60.2    61  2774  6.83  6.9   4.13
&gt;  3  1.01 Premium   F      61.8    60  2781  6.39  6.36  3.94
&gt;  4  1.01 Fair      E      64.5    58  2788  6.29  6.21  4.03
&gt;  5  0.96 Ideal     F      60.7    55  2801  6.37  6.41  3.88
&gt;  6  1.04 Premium   G      62.2    58  2801  6.46  6.41  4   
&gt;  7  1    Fair      G      66.4    59  2808  6.16  6.09  4.07
&gt;  8  1.2  Fair      F      64.6    56  2809  6.73  6.66  4.33
&gt;  9  0.43 Very Good E      58.4    62   555  4.94  5     2.9 
&gt; 10  1.02 Premium   G      60.3    58  2815  6.55  6.5   3.94
&gt; # ℹ 731 more rows</code></pre>
</div>
</div>
</section>
<section id="using-walk" class="level2">
<h2 class="anchored" data-anchor-id="using-walk">Using <code>walk()</code></h2>
<p>We basically want to carry out the following but we can’t simply use <code>map()</code> because now we have <em>2</em> arguments that vary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(by_clarity<span class="sc">$</span>data[[<span class="dv">1</span>]], by_clarity<span class="sc">$</span>path[[<span class="dv">1</span>]])</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(by_clarity<span class="sc">$</span>data[[<span class="dv">2</span>]], by_clarity<span class="sc">$</span>path[[<span class="dv">2</span>]])</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(by_clarity<span class="sc">$</span>data[[<span class="dv">3</span>]], by_clarity<span class="sc">$</span>path[[<span class="dv">3</span>]])</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(by_clarity<span class="sc">$</span>by_clarity[[<span class="dv">8</span>]], by_clarity<span class="sc">$</span>path[[<span class="dv">8</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>So we could use <code>map2()</code>, which allows us to map over <strong>2</strong> inputs!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(by_clarity<span class="sc">$</span>data, by_clarity<span class="sc">$</span>path, write_csv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>If we were to run the above, it will apply the first two arguments to the <code>write_csv()</code> function <em>and also print out all the datasets as it saves them</em>.</p>
<p>. . .</p>
<p>Since we don’t actually care about the output (i.e.&nbsp;the printed datasets) and only want the files to be written, there’s an even better function we can use: <code>walk2()</code>.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(by_clarity<span class="sc">$</span>data, by_clarity<span class="sc">$</span>path, write_csv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This performs the exact same thing as <code>map2()</code> but throws the output away. Therefore we’re left with just the file-saving behavior which is what we’re after.</p>
</section>
<section id="saving-multiple-plots" class="level2">
<h2 class="anchored" data-anchor-id="saving-multiple-plots">Saving multiple plots</h2>
<p>The same basic approach can be used to save multiple plots.</p>
<p>. . .</p>
<p>First let’s create a function that draws the plot we want.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>carat_histogram <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> carat)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>)  </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">carat_histogram</span>(by_clarity<span class="sc">$</span>data[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CSSS508_Lecture9_files/figure-html/unnamed-chunk-49-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="saving-multiple-plots-fa-scroll" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="saving-multiple-plots-fa-scroll">Saving multiple plots <span style="color:#99a486"><i class="fa-solid fa-scroll" aria-label="scroll"></i></span></h2>
<p>Now we can use <code>map()</code> to create a list of many plots and their eventual file paths:</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>by_clarity <span class="ot">&lt;-</span> by_clarity <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot =</span> <span class="fu">map</span>(data, carat_histogram),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">str_glue</span>(<span class="st">"clarity-{clarity}.png"</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>by_clarity</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 8 × 4
&gt;   clarity               data path             plot  
&gt;   &lt;ord&gt;   &lt;list&lt;tibble[,9]&gt;&gt; &lt;glue&gt;           &lt;list&gt;
&gt; 1 I1               [741 × 9] clarity-I1.png   &lt;gg&gt;  
&gt; 2 SI2            [9,194 × 9] clarity-SI2.png  &lt;gg&gt;  
&gt; 3 SI1           [13,065 × 9] clarity-SI1.png  &lt;gg&gt;  
&gt; 4 VS2           [12,258 × 9] clarity-VS2.png  &lt;gg&gt;  
&gt; 5 VS1            [8,171 × 9] clarity-VS1.png  &lt;gg&gt;  
&gt; 6 VVS2           [5,066 × 9] clarity-VVS2.png &lt;gg&gt;  
&gt; 7 VVS1           [3,655 × 9] clarity-VVS1.png &lt;gg&gt;  
&gt; 8 IF             [1,790 × 9] clarity-IF.png   &lt;gg&gt;</code></pre>
</div>
</div>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>by_clarity<span class="sc">$</span>plot[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="CSSS508_Lecture9_files/figure-html/unnamed-chunk-51-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="saving-multiple-plots-1" class="level2">
<h2 class="anchored" data-anchor-id="saving-multiple-plots-1">Saving multiple plots</h2>
<p>Then use <code>walk2()</code> with <code>ggsave()</code> to save each plot:</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  by_clarity<span class="sc">$</span>path,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  by_clarity<span class="sc">$</span>plot,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  \(path, plot) <span class="fu">ggsave</span>(path, plot, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>. . .</p>
<p>Which is shorthand for:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(by_clarity<span class="sc">$</span>path[[<span class="dv">1</span>]], by_clarity<span class="sc">$</span>plot[[<span class="dv">1</span>]], <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(by_clarity<span class="sc">$</span>path[[<span class="dv">2</span>]], by_clarity<span class="sc">$</span>plot[[<span class="dv">2</span>]], <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(by_clarity<span class="sc">$</span>path[[<span class="dv">3</span>]], by_clarity<span class="sc">$</span>plot[[<span class="dv">3</span>]], <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(by_clarity<span class="sc">$</span>path[[<span class="dv">8</span>]], by_clarity<span class="sc">$</span>plot[[<span class="dv">8</span>]], <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="apply-family" class="level1 section-title" data-background-color="#99a486">
<h1 class="section-title" data-background-color="#99a486">Apply Family</h1>
<section id="lapply" class="level2">
<h2 class="anchored" data-anchor-id="lapply"><code>lapply</code></h2>
<p>Base <code>R</code> has it’s own family of iterative functions: the apply family of functions.</p>
<p>. . .</p>
<p>The most one-to-one translation in this family is <code>lapply</code> (list apply) to <code>map</code>.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-36"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-36-1" class="code-annotation-target"><a href="#annotated-cell-36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(swiss, <span class="at">FUN =</span> median)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-36" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1" data-code-cell="annotated-cell-36" data-code-annotation="1">Since all of the examples of <code>map</code> in today’s lecture are fairly simple, you can swap in <code>lapply</code> for any of them.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; $Fertility
&gt; [1] 70.4
&gt; 
&gt; $Agriculture
&gt; [1] 54.1
&gt; 
&gt; $Examination
&gt; [1] 16
&gt; 
&gt; $Education
&gt; [1] 8
&gt; 
&gt; $Catholic
&gt; [1] 15.14
&gt; 
&gt; $Infant.Mortality
&gt; [1] 20</code></pre>
</div>
</div>
<p>Simply, <code>lapply()</code> is used to apply a function over a list of any kind (e.g.&nbsp;a data frame) and return a list.</p>
</section>
<section id="sapply-simple-lapply" class="level2">
<h2 class="anchored" data-anchor-id="sapply-simple-lapply"><code>sapply()</code>: Simple <code>lapply()</code></h2>
<p>A downside to <code>lapply()</code> is that lists can be hard to work with. <code>sapply()</code>, therefore, always tries to simplify the result.</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(swiss, <span class="at">FUN =</span> median)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;        Fertility      Agriculture      Examination        Education 
&gt;            70.40            54.10            16.00             8.00 
&gt;         Catholic Infant.Mortality 
&gt;            15.14            20.00</code></pre>
</div>
</div>
<p>In this case, our list was simplified to a named numeric vector. However, the simplification can fail and give you an unexpected type so proceed with caution if you intend to use <code>sapply()</code>.</p>
<p>. . .</p>
<section id="vapply-vector-apply" class="level4">
<h4 class="anchored" data-anchor-id="vapply-vector-apply"><code>vapply()</code>: vector apply</h4>
<p>This version takes an additional argument that specifies the expected type, ensuring that simplification occurs the same way regardless of the input.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(swiss, median, <span class="fu">double</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;        Fertility      Agriculture      Examination        Education 
&gt;            70.40            54.10            16.00             8.00 
&gt;         Catholic Infant.Mortality 
&gt;            15.14            20.00</code></pre>
</div>
</div>
</div>
</section>
</section>
<section id="tapply" class="level2">
<h2 class="anchored" data-anchor-id="tapply"><code>tapply()</code></h2>
<p>Another important member of the apply family is <code>tapply()</code> which computes a single grouped summary.</p>
<p>. . .</p>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb62" data-code-line-numbers="false"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cut) <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">price =</span> <span class="fu">mean</span>(price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 5 × 2
&gt;   cut       price
&gt;   &lt;ord&gt;     &lt;dbl&gt;
&gt; 1 Fair      4359.
&gt; 2 Good      3929.
&gt; 3 Very Good 3982.
&gt; 4 Premium   4584.
&gt; 5 Ideal     3458.</code></pre>
</div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb64" data-code-line-numbers="false"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(diamonds<span class="sc">$</span>price, diamonds<span class="sc">$</span>cut, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;      Fair      Good Very Good   Premium     Ideal 
&gt;      4359      3929      3982      4584      3458</code></pre>
</div>
</div>
</div>
</div>
<p>. . .</p>
<p><br></p>
<p>Unfortunately <code>tapply()</code> returns its results in a named vector which requires some gymnastics if you want to collect multiple summaries and grouping variables into a data frame.</p>
</section>
<section id="apply" class="level2">
<h2 class="anchored" data-anchor-id="apply"><code>apply()</code></h2>
<p>Lastly, there’s <code>apply()</code>, which works over matrices or data frames. You can apply the function to each row <code>(MARGIN = 1)</code> or column <code>(MARGIN = 2)</code>.</p>
<p>. . .</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(swiss, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;         Fertility Agriculture Examination Education Catholic Infant.Mortality
&gt; Min.        35.00        1.20        3.00      1.00    2.150            10.80
&gt; 1st Qu.     64.70       35.90       12.00      6.00    5.195            18.15
&gt; Median      70.40       54.10       16.00      8.00   15.140            20.00
&gt; Mean        70.14       50.66       16.49     10.98   41.144            19.94
&gt; 3rd Qu.     78.45       67.65       22.00     12.00   93.125            21.70
&gt; Max.        92.50       89.70       37.00     53.00  100.000            26.60</code></pre>
</div>
</div>
</section>
</section>
<section id="for-loops" class="level1 section-title" data-background-color="#99a486">
<h1 class="section-title" data-background-color="#99a486"><code>for</code> loops</h1>
<section id="anatomy-of-a-for-loop" class="level2">
<h2 class="anchored" data-anchor-id="anatomy-of-a-for-loop">Anatomy of a <code>for</code> loop</h2>
<p><code>for</code> loops are the fundamental building block of iteration that both the apply and map families use under the hood.</p>
<p>. . .</p>
<p>As you become a more experienced <code>R</code> programmer, <code>for</code> loops are a powerful and general tool that will be important to learn.</p>
<p>. . .</p>
<p><br></p>
<p>The basic structure of a for loop looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (element <span class="cf">in</span> vector) {</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do something with element</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="parallel-with-walk" class="level2">
<h2 class="anchored" data-anchor-id="parallel-with-walk">Parallel with <code>walk()</code></h2>
<p>The most straightforward use of for loops is to achieve the same effect as <code>walk()</code>: call some function with a side-effect on each element of a vector/list.</p>
<p>. . .</p>
<p>A <em>very</em> basic example:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(i)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 1
&gt; [1] 2
&gt; [1] 3
&gt; [1] 4
&gt; [1] 5
&gt; [1] 6
&gt; [1] 7
&gt; [1] 8
&gt; [1] 9
&gt; [1] 10</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">|&gt;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk</span>(\(x) <span class="fu">print</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 1
&gt; [1] 2
&gt; [1] 3
&gt; [1] 4
&gt; [1] 5
&gt; [1] 6
&gt; [1] 7
&gt; [1] 8
&gt; [1] 9
&gt; [1] 10</code></pre>
</div>
</div>
</div>
</div>
<p>. . .</p>
<p>Things get a little trickier if you want to save the output of the for loop.</p>
<p>. . .</p>
<p>When you’re ready to dive into more advanced functional programming topics, including loops, check out the <a href="https://adv-r.hadley.nz/control-flow.html#control-flow">Control Flow</a> and <a href="https://adv-r.hadley.nz/fp.html">Functional Programming</a> chapters of <em>Advanced R</em>.</p>
</section>
</section>
<section id="lab" class="level1 section-title" data-background-color="#99a486">
<h1 class="section-title" data-background-color="#99a486">Lab</h1>
<section id="iteration-with-across" class="level2">
<h2 class="anchored" data-anchor-id="iteration-with-across">Iteration with <code>across</code></h2>
<ol type="1">
<li><p>Compute the number of unique values in each column of <code>palmerpenguins::penguins</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p></li>
<li><p>Compute the mean of every column in <code>mtcars.</code></p></li>
<li><p>Group <code>diamonds</code> by <code>cut</code>, <code>clarity</code>, and <code>color</code> then count the number of observations and compute the mean of each numeric column.</p></li>
<li><p>What happens if you use a list of functions in <code>across()</code>, but don’t name them? How is the output named?</p></li>
</ol>
</section>
<section id="answers" class="level2" data-visibility="hidden">
<h2 data-visibility="hidden" class="anchored" data-anchor-id="answers">Answers</h2>
<ol type="1">
<li>Compute the number of unique values in each column of <code>palmerpenguins::penguins</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</li>
</ol>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(penguins)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), n_distinct))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 1 × 8
&gt;   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
&gt;     &lt;int&gt;  &lt;int&gt;          &lt;int&gt;         &lt;int&gt;             &lt;int&gt;       &lt;int&gt;
&gt; 1       3      3            165            81                56          95
&gt; # ℹ 2 more variables: sex &lt;int&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="answers-1" class="level2" data-visibility="hidden">
<h2 data-visibility="hidden" class="anchored" data-anchor-id="answers-1">Answers</h2>
<ol start="2" type="1">
<li>Compute the mean of every column in <code>mtcars.</code></li>
</ol>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;     mpg   cyl  disp    hp  drat    wt  qsec     vs     am  gear  carb
&gt; 1 20.09 6.188 230.7 146.7 3.597 3.217 17.85 0.4375 0.4062 3.688 2.812</code></pre>
</div>
</div>
</section>
<section id="answers-2" class="level2" data-visibility="hidden">
<h2 data-visibility="hidden" class="anchored" data-anchor-id="answers-2">Answers</h2>
<ol start="3" type="1">
<li>Group <code>diamonds</code> by <code>cut</code>, <code>clarity</code>, and <code>color</code> then count the number of observations and compute the mean of each numeric column.</li>
</ol>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">.by =</span> <span class="fu">c</span>(cut, clarity, color))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 276 × 11
&gt;    cut       clarity color     n carat depth table price     x     y     z
&gt;    &lt;ord&gt;     &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
&gt;  1 Ideal     SI2     E       469 0.874  61.7  56.1 3891.  6.02  6.02  3.71
&gt;  2 Premium   SI1     E       614 0.726  61.2  58.8 3363.  5.64  5.61  3.44
&gt;  3 Good      VS1     E        89 0.681  61.6  59.2 3713.  5.49  5.52  3.39
&gt;  4 Premium   VS2     I       315 1.24   61.3  58.9 7156.  6.70  6.67  4.09
&gt;  5 Good      SI2     J        53 1.32   62.4  59.1 5306.  6.85  6.86  4.27
&gt;  6 Very Good VVS2    J        29 1.10   62.4  58.3 5960.  6.34  6.37  3.96
&gt;  7 Very Good VVS1    I        69 0.571  62.2  58.0 2056.  5.17  5.20  3.22
&gt;  8 Very Good SI1     H       547 0.974  62.0  58.0 4934.  6.15  6.17  3.82
&gt;  9 Fair      VS2     E        42 0.690  64.5  59.4 3042.  5.50  5.45  3.53
&gt; 10 Very Good VS1     H       257 0.772  62.0  57.7 3750.  5.68  5.70  3.53
&gt; # ℹ 266 more rows</code></pre>
</div>
</div>
</section>
<section id="answers-3" class="level2" data-visibility="hidden">
<h2 data-visibility="hidden" class="anchored" data-anchor-id="answers-3">Answers</h2>
<ol start="4" type="1">
<li>What happens if you use a list of functions in <code>across()</code> but don’t name them? How is the output named?</li>
</ol>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">|&gt;</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(Ozone<span class="sc">:</span>Day, <span class="fu">list</span>(</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>      \(x) <span class="fu">median</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>      \(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x))</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   Ozone_1 Ozone_2 Solar.R_1 Solar.R_2 Wind_1 Wind_2 Temp_1 Temp_2 Month_1
&gt; 1    31.5      37       205         7    9.7      0     79      0       7
&gt;   Month_2 Day_1 Day_2   n
&gt; 1       0    16     0 153</code></pre>
</div>
</div>
<p>The default behavior of <code>across</code> if the names for multiple functions are not supplied is simply to append the variable name with a number, i.e.&nbsp;the first function will be <code>{.col}_1</code>, the second function will be <code>{.col}_2</code>, etc.</p>
</section>
</section>
<section id="homework" class="level1 section-title" data-background-color="#1e4655">
<h1 class="section-title" data-background-color="#1e4655">Homework</h1>
<section id="section-1" class="level2" data-menu-title="Homework 9" data-background-iframe="https://vsass.github.io/CSSS508/Homework/HW9/homework9.html" data-background-interactive="TRUE">
<h2 data-menu-title="Homework 9" data-background-iframe="https://vsass.github.io/CSSS508/Homework/HW9/homework9.html" data-background-interactive="TRUE" class="anchored" data-anchor-id="section-1"></h2>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>You’ll need to download the <code>palmerpenguins</code> package in order to use <code>penguins</code> dataset.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>You’ll need to download the <code>palmerpenguins</code> package in order to use <code>penguins</code> dataset.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Created with <a href="https://quarto.org/">Quarto</a> • <a href="https://creativecommons.org/licenses/by-nc/4.0/">License</a></div>   
    <div class="nav-footer-center">Copyright © 2023 Victoria Sass <br> Course content adapted from <a href="https://clanfear.github.io/CSSS508/">Chuck Lanfear</a> and <a href="https://pearce790.github.io/CSSS508/index.html">Michael Pearce</a></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:vsass@uw.edu">
      <i class="bi bi-envelope-at" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=A3lEdiIAAAAJ&amp;hl=en">
      <i class="bi bi-google" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/vsass">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="http://vsass.github.io/Sass_Victoria_CV_2023.pdf">
      <i class="bi bi-file-person" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>