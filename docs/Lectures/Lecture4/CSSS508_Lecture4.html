<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c3c2c9e745155556954bc4da23476b10.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.32">

  <title>csss508_lecture4</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #97947a;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #97947a;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2; background-color: #2b2b2b; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #dcc6e0; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #ffd700; } /* Attribute */
    code span.bn { color: #dcc6e0; } /* BaseN */
    code span.bu { color: #f5ab35; } /* BuiltIn */
    code span.cf { color: #ffa07a; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffa07a; } /* Constant */
    code span.co { color: #d4d0ab; } /* Comment */
    code span.cv { color: #d4d0ab; font-style: italic; } /* CommentVar */
    code span.do { color: #d4d0ab; font-style: italic; } /* Documentation */
    code span.dt { color: #dcc6e0; } /* DataType */
    code span.dv { color: #dcc6e0; } /* DecVal */
    code span.er { color: #dcc6e0; } /* Error */
    code span.ex { color: #ffd700; } /* Extension */
    code span.fl { color: #f5ab35; } /* Float */
    code span.fu { color: #ffd700; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; } /* Keyword */
    code span.op { color: #00e0e0; } /* Operator */
    code span.ot { color: #ffa07a; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.sc { color: #00e0e0; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #f5ab35; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #d4d0ab; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-c46ecff957183314c48e90e2e9279a7f.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-pointer/pointer.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">


<section id="title-slide" class="slide level2 center" data-menu-title="Manipulating and Summarizing Data" data-background="#1e4655" data-background-image="../../images/csss-logo.png" data-background-position="center top 5%" data-background-size="50%">
<h2></h2>
<p><span class="custom-title">Manipulating and Summarizing Data</span></p>
<p><span class="custom-subtitle">CS&amp;SS 508 • Lecture 4</span></p>
<p><span class="custom-subtitle2">21 October 2025</span></p>
<p><span class="custom-subtitle3">Victoria Sass</span></p>
</section>
<section>
<section id="roadmap" class="title-slide slide level1 section-title center" data-background-color="#99a486">
<h1>Roadmap</h1>

</section>
<section class="slide level2">

<div class="columns">
<div class="column" style="width:50%;">
<p><br></p>
<h3 id="last-time-we-learned">Last time, we learned:</h3>
<ul>
<li>Best Practices
<ul>
<li>Code Style</li>
<li>Workflow</li>
</ul></li>
<li>Reproducible Research</li>
<li>Indexing vectors &amp; dataframes in Base <code>R</code></li>
</ul>
</div><div class="column" style="width:50%;">
<p><br></p>
<div class="fragment">
<h3 id="today-we-will-cover">Today, we will cover:</h3>
<ul>
<li>Types of Data
<ul>
<li>Logical Operators</li>
</ul></li>
<li>Subsetting data</li>
<li>Modifying data</li>
<li>Summarizing data</li>
<li>Merging data</li>
</ul>
</div>
</div></div>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/transform.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</section>
<section id="death-to-spreadsheets" class="slide level2">
<h2>Death to Spreadsheets</h2>
<p>Tools like <em>Excel</em> or <em>Google Sheets</em> let you manipulate spreadsheets using functions.</p>
<ul>
<li class="fragment">Spreadsheets are <em>not reproducible</em>: It’s hard to know how someone changed the raw data!</li>
<li class="fragment">It’s hard to catch mistakes when you use spreadsheets<sup>1</sup>.</li>
</ul>
<div class="fragment">
<p>Today, we’ll use <code>R</code> to manipulate data more <em>transparently</em> and <em>reproducibly</em>.</p>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>Don’t be the next sad Research Assistant who makes headlines with an Excel error! (<a href="http://www.bloomberg.com/news/articles/2013-04-18/faq-reinhart-rogoff-and-the-excel-error-that-changed-history">Reinhart &amp; Rogoff, 2010</a>)</p></li></ol></aside></section>
<section id="how-is-data-stored-in-r" class="slide level2">
<h2>How is data stored in <code>R</code>?</h2>
<p>Under the hood, R stores different types of data in different ways.</p>
<div class="fragment">
<ul>
<li>e.g., R knows that <code>4.0</code> is a number, and that <code>"Vic"</code> is not a number.</li>
</ul>
</div>
<div class="fragment">
<p>So what exactly are the common data types, and how do we know what R is doing?</p>
</div>
<div class="fragment">
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>Logicals (<code>logical</code>)</li>
<li>Factors (<code>factor</code>)</li>
<li>Date/Date-time (<code>Date</code>, <code>POSIXct</code>, <code>POSIXt</code>)</li>
<li>Numbers (<code>integer</code>, <code>double</code>)</li>
<li>Missing Values (<code>NA</code>, <code>NaN</code>, <code>Inf</code>)</li>
<li>Character Strings (<code>character</code>)</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="fragment">
<ul>
<li><code>c(FALSE, TRUE, TRUE)</code></li>
<li><code>factor(c("red", "blue"))</code></li>
<li><code>as_Date(c("2018-10-04"))</code></li>
<li><code>c(1, 10*3, 4, -3.14)</code></li>
<li><code>c(NA, NA, NA, NaN, NaN, NA)</code></li>
<li><code>c("red", "blue", "blue")</code></li>
</ul>
</div>
</div></div>
</div>
</section></section>
<section>
<section id="logical-operators" class="title-slide slide level1 section-title center" data-background-color="#99a486">
<h1>Logical Operators</h1>

</section>
<section id="booleans" class="slide level2">
<h2>Booleans</h2>
<p>The simplest data type is a Boolean, or binary, variable: <code>TRUE</code> or <code>FALSE</code><sup>1</sup>.</p>
<div class="fragment">
<p>More often than not our data don’t actually have a variable with this data type, but they are definitely created and evaluated in the data manipulation and summarizing process.</p>
</div>
<div class="fragment">
<p>Logical operators refer to base functions which allow us to <strong>test if a condition</strong> is present between two objects.</p>
</div>
<div class="fragment">
<p>For example, we may test</p>
<ul>
<li>Is A equal to B?</li>
<li>Is A greater than B?</li>
<li>Is A within B?</li>
</ul>
</div>
<div class="fragment">
<p>Naturally, these types of expressions produce a binary outcome of <code>T</code> or <code>F</code> which enables us to transform our data in a variety of ways!</p>
</div>
<aside><ol class="aside-footnotes"><li id="fn2"><p>or <code>NA</code></p></li></ol></aside></section>
<section id="logical-operators-in-r" class="slide level2">
<h2>Logical Operators in <code>R</code></h2>
<h4 id="comparing-objects">Comparing objects</h4>
<div class="columns">
<div class="column" style="width:19%;">
<div class="fragment">
<ul>
<li><code>==</code>:</li>
<li><code>!=</code>:</li>
<li><code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>:</li>
<li><code>%in%</code>:</li>
</ul>
</div>
</div><div class="column" style="width:81%;">
<div class="fragment">
<ul>
<li>is equal to<sup>1</sup></li>
<li>not equal to</li>
<li>less than, less than or equal to, etc.</li>
<li>used when checking if equal to one of several values</li>
</ul>
</div>
</div></div>
<div class="fragment">
<h4 id="combining-comparisons">Combining comparisons</h4>
</div>
<div class="columns">
<div class="column" style="width:19%;">
<div class="fragment">
<ul>
<li><code>&amp;</code>:</li>
<li><code>|</code>:</li>
<li><code>!</code>:</li>
<li><code>xor()</code>:</li>
</ul>
</div>
</div><div class="column" style="width:81%;">
<div class="fragment bullet-spacing">
<ul>
<li><strong>both</strong> conditions need to hold (AND)<br>
</li>
<li><strong>at least one</strong> condition needs to hold (OR)<br>
</li>
<li><strong>inverts</strong> a logical condition (<code>TRUE</code> becomes <code>FALSE</code>, vice versa)<br>
</li>
<li><strong>exclusive OR</strong> (i.e.&nbsp;x or y but NOT both)</li>
</ul>
</div>
</div></div>

<aside><div>
<p><span class="fragment">You may also see <code>&amp;&amp;</code> and <code>||</code> but they are what’s known as short-circuiting operators and are not to be used in <code>dplyr</code> functions (used for programming not data manipulation); they’ll only ever return a single <code>TRUE</code> or <code>FALSE</code>.</span></p>
</div><ol class="aside-footnotes"><li id="fn3"><p>Note: there are TWO equal signs here!</p></li></ol></aside></section>
<section id="unexpected-behavior" class="slide level2">
<h2>Unexpected Behavior</h2>
<p>Be careful using <code>==</code> with numbers:</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-1" class="code-annotation-target"><a href="#annotated-cell-1-1"></a>(x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">49</span> <span class="sc">*</span> <span class="dv">49</span>, <span class="fu">sqrt</span>(<span class="dv">2</span>) <span class="sc">^</span> <span class="dv">2</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="1" data-code-annotation="1">Wrapping an entire object assignment in parentheses simultaneously defines the object and shows you what it represents.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2">2</button><span id="annotated-cell-2-1" class="code-annotation-target"><a href="#annotated-cell-2-1"></a>x <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3">3</button><span id="annotated-cell-2-2" class="code-annotation-target"><a href="#annotated-cell-2-2"></a><span class="fu">print</span>(x, <span class="at">digits =</span> <span class="dv">16</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="1" data-code-annotation="2">Computers store numbers with a fixed number of decimal places so there’s no way to <em>precisely</em> represent decimals.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="2" data-code-annotation="3"><code>dplyr::near()</code> is a useful alternative which ignores small differences.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE
[1] 0.9999999999999999 2.0000000000000004</code></pre>
</div>
</div>
</div>
<div class="fragment">
<p>Similarly mysterious, missing values (<code>NA</code>) represent the unknown. Almost anything conditional involving <code>NA</code>s will also be unknown:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1"></a><span class="cn">NA</span> <span class="sc">&gt;</span> <span class="dv">5</span></span>
<span id="annotated-cell-3-2"><a href="#annotated-cell-3-2"></a><span class="dv">10</span> <span class="sc">==</span> <span class="cn">NA</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="4">4</button><span id="annotated-cell-3-3" class="code-annotation-target"><a href="#annotated-cell-3-3"></a><span class="cn">NA</span> <span class="sc">==</span> <span class="cn">NA</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="3" data-code-annotation="4">The logic here: if you have one unknown and a second unknown, you don’t actually know if they equal one another!</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA
[1] NA
[1] NA</code></pre>
</div>
</div>
</div>
<div class="fragment">
<p>This is the reason we use <code>is.na()</code> to check for missingness.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="fu">is.na</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE FALSE</code></pre>
</div>
</div>
</div>
</section>
<section id="examples-of-logical-operators" class="slide level2">
<h2>Examples of Logical Operators</h2>
<p>Let’s create two objects, <code>A</code> and <code>B</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>A <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>)</span>
<span id="cb6-2"><a></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Comparisons:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-6"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-6-1"><a href="#annotated-cell-6-1"></a>A <span class="sc">==</span> B</span>
<span id="annotated-cell-6-2"><a href="#annotated-cell-6-2"></a>A <span class="sc">&gt;</span> B</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-3" class="code-annotation-target"><a href="#annotated-cell-6-3"></a>A <span class="sc">%in%</span> B</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="3" data-code-annotation="1">Will return a vector the length of <code>A</code> that is <code>TRUE</code> whenever a value in <code>A</code> is anywhere in <code>B</code>. <br> <strong>Note</strong>: You CAN use <code>%in%</code> to search for <code>NA</code>s.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE FALSE FALSE
[1] FALSE FALSE FALSE
[1]  TRUE FALSE  TRUE</code></pre>
</div>
</div>
</div>
<div class="fragment">
<p>Combinations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1"></a>A <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">&amp;</span> A <span class="sc">&lt;=</span> B </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2">2</button><span id="annotated-cell-7-2" class="code-annotation-target"><a href="#annotated-cell-7-2"></a>B <span class="sc">&lt;</span> <span class="dv">10</span> <span class="sc">|</span> B <span class="sc">&gt;</span> <span class="dv">20</span></span>
<span id="annotated-cell-7-3"><a href="#annotated-cell-7-3"></a><span class="sc">!</span>(A <span class="sc">==</span> <span class="dv">10</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="2" data-code-annotation="2">Be sure not to cut corners (i.e.&nbsp;writing <br> <code>B &lt; 10 | &gt; 20</code>). The code won’t technically error but it won’t evaluate the way you expect it to. Read more about the confusing logic behind this <a href="https://r4ds.hadley.nz/logicals#sec-order-operations-boolean">here</a>. In essence the truncated second part of this conditional statement (&gt; 20) will evaluate to <code>TRUE</code> since any numeric that isn’t <code>0</code> for a logical operator is coerced to <code>TRUE</code>. Therefore this statement will actually always evaluate to <code>TRUE</code> and will return all elements of <code>B</code> instead of the ones that meet your specified condition.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE  TRUE
[1]  TRUE FALSE  TRUE
[1]  TRUE FALSE  TRUE</code></pre>
</div>
</div>
</div>
</section>
<section id="logical-summaries" class="slide level2">
<h2>Logical Summaries</h2>
<div class="columns">
<div class="column" style="width:19%;">
<div class="fragment">
<ul>
<li><code>any()</code>:</li>
<li><code>all()</code>:</li>
</ul>
</div>
</div><div class="column" style="width:81%;">
<div class="fragment">
<ul>
<li>the equivalent of <code>|</code>; it’ll return <code>TRUE</code> if there are any <code>TRUE</code>’s in x</li>
<li>the equivalent of <code>&amp;</code>; it’ll return <code>TRUE</code> only if all values of x are <code>TRUE</code>’s</li>
</ul>
</div>
</div></div>
<div class="fragment">
<hr>
<p><br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>C <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="cn">NA</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="cn">NA</span>)</span>
<span id="cb9-2"><a></a><span class="fu">any</span>(C <span class="sc">&lt;=</span> <span class="dv">10</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1">1</button><span id="annotated-cell-9-1" class="code-annotation-target"><a href="#annotated-cell-9-1"></a><span class="fu">all</span>(C <span class="sc">&lt;=</span> <span class="dv">20</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="1" data-code-annotation="1">Like other summary functions, they’ll return <code>NA</code> if there are any missing values present and it’s <code>FALSE</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2">2</button><span id="annotated-cell-10-1" class="code-annotation-target"><a href="#annotated-cell-10-1"></a><span class="fu">all</span>(C <span class="sc">&lt;=</span> <span class="dv">20</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="1" data-code-annotation="2">Use <code>na.rm = TRUE</code> to remove <code>NA</code>s prior to evaluation.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="3">3</button><span id="annotated-cell-11-1" class="code-annotation-target"><a href="#annotated-cell-11-1"></a><span class="fu">mean</span>(C, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="1" data-code-annotation="3">When you evaluate a logical vector numerically, <code>TRUE</code> = 1 and <code>FALSE</code> = 0. This makes <code>sum()</code> and <code>mean()</code> useful when summarizing logical functions (sum gives number of <code>TRUE</code>s and mean gives the proportion).</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.25</code></pre>
</div>
</div>
</div>
</section>
<section id="conditional-transformations" class="slide level2">
<h2>Conditional transformations</h2>
<ins>
<strong><code>if_else()</code></strong>
</ins>
<p>If you want to use one value when a condition is <code>TRUE</code> and another value when it’s <code>FALSE</code>.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1">1</button><span id="annotated-cell-12-1" class="code-annotation-target"><a href="#annotated-cell-12-1"></a><span class="fu">if_else</span>(<span class="at">condition =</span> <span class="st">"A logical vector"</span>,</span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2"></a>        <span class="at">true =</span> <span class="st">"Output when condition is true"</span>,</span>
<span id="annotated-cell-12-3"><a href="#annotated-cell-12-3"></a>        <span class="at">false =</span> <span class="st">"Output when condition is false"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="1,2,3" data-code-annotation="1">All of these arguments are required.</span>
</dd>
</dl>
</div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-13-1"><a href="#annotated-cell-13-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>, <span class="cn">NA</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2">2</button><span id="annotated-cell-13-2" class="code-annotation-target"><a href="#annotated-cell-13-2"></a><span class="fu">if_else</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"+ve"</span>, <span class="st">"-ve"</span>, <span class="st">"???"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="2" data-code-annotation="2">There’s an optional fourth argument, <code>missing</code>, which will be used if the input is <code>NA</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "-ve" "-ve" "-ve" "-ve" "+ve" "+ve" "+ve" "???"</code></pre>
</div>
</div>
</div>
<div class="fragment">
<ins>
<strong><code>case_when()</code></strong>
</ins>
<p>A very useful extension of <code>if_else()</code> for multiple conditions<sup>1</sup>.</p>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-14-1"><a href="#annotated-cell-14-1"></a><span class="fu">case_when</span>(</span>
<span id="annotated-cell-14-2"><a href="#annotated-cell-14-2"></a>  x <span class="sc">==</span> <span class="dv">0</span>   <span class="sc">~</span> <span class="st">"0"</span>,</span>
<span id="annotated-cell-14-3"><a href="#annotated-cell-14-3"></a>  x <span class="sc">&lt;</span> <span class="dv">0</span>    <span class="sc">~</span> <span class="st">"-ve"</span>, </span>
<span id="annotated-cell-14-4"><a href="#annotated-cell-14-4"></a>  x <span class="sc">&gt;</span> <span class="dv">0</span>    <span class="sc">~</span> <span class="st">"+ve"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="10">10</button><span id="annotated-cell-14-5" class="code-annotation-target"><a href="#annotated-cell-14-5"></a>  <span class="fu">is.na</span>(x) <span class="sc">~</span> <span class="st">"???"</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="11">11</button><span id="annotated-cell-14-6" class="code-annotation-target"><a href="#annotated-cell-14-6"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="10">10</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="5" data-code-annotation="10">Use <code>.default</code> if you want to create a “default”/catch all value.</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="11">11</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="6" data-code-annotation="11">Both functions require compatible types: i.e.&nbsp;numerical and logical, strings and factors, dates and datetimes, <code>NA</code> and everything.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "-ve" "-ve" "-ve" "0"   "+ve" "+ve" "+ve" "???"</code></pre>
</div>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn4"><p>Note that if multiple conditions match in <code>case_when()</code>, only the first will be used. </p></li></ol></aside></section></section>
<section>
<section id="section" class="title-slide slide level1 section-title center" data-menu-title="`dplyr`" data-background-image="images/dplyr.png" data-background-size="contain" data-background-position="center" data-background-color="#1e4655">
<h1></h1>

</section>
<section id="dplyr" class="slide level2">
<h2><code>dplyr</code></h2>
<p>Today, we’ll use tools from the <code>dplyr</code> package to manipulate data!</p>
<ul>
<li>Like <code>ggplot2</code>, <code>dplyr</code> is part of the <em>Tidyverse</em>, and included in the <code>tidyverse</code> package.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>To demonstrate data transformations we’re going to use the <code>nycflights13</code> dataset, which you’ll need to download and load into <code>R</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-16"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="1">1</button><span id="annotated-cell-16-1" class="code-annotation-target"><a href="#annotated-cell-16-1"></a><span class="fu">library</span>(nycflights13)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-16" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="1" data-code-annotation="1">Run <code>install.packages("nycflights13")</code> in console first.</span>
</dd>
</dl>
</div>
</div>
</div>
<div class="fragment">
<p><code>nycflights13</code> includes five data frames<sup>1</sup>:, some of which contain missing data (<code>NA</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-17"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="2">2</button><span id="annotated-cell-17-1" class="code-annotation-target"><a href="#annotated-cell-17-1"></a><span class="fu">data</span>(flights)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="3">3</button><span id="annotated-cell-17-2" class="code-annotation-target"><a href="#annotated-cell-17-2"></a><span class="fu">data</span>(airlines)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="4">4</button><span id="annotated-cell-17-3" class="code-annotation-target"><a href="#annotated-cell-17-3"></a><span class="fu">data</span>(airports)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="5">5</button><span id="annotated-cell-17-4" class="code-annotation-target"><a href="#annotated-cell-17-4"></a><span class="fu">data</span>(planes)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="6">6</button><span id="annotated-cell-17-5" class="code-annotation-target"><a href="#annotated-cell-17-5"></a><span class="fu">data</span>(weather)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="1" data-code-annotation="2">flights leaving JFK, LGA, or EWR in 2013</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="2" data-code-annotation="3">airline abbreviations</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="3" data-code-annotation="4">airport metadata</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="4" data-code-annotation="5">airplane metadata</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="5" data-code-annotation="6">hourly weather data for JFK, LGA, and EWR</span>
</dd>
</dl>
</div>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn5"><p>Note these are separate data frames, each needing to be loaded separately. When loading a package containing datasets, you can define those data (i.e.&nbsp;explicitly add them to your working environment) by calling <code>data()</code> on their name.</p></li></ol></aside></section>
<section id="dplyr-basics" class="slide level2">
<h2><code>dplyr</code> Basics</h2>
<p>All <code>dplyr</code> functions have the following in common:</p>
<ol type="1">
<li class="fragment">The first argument is always a data frame.</li>
<li class="fragment">The subsequent arguments typically describe which columns to operate on, using the variable names (without quotes).</li>
<li class="fragment">The output is always a new data frame.</li>
</ol>
<div class="fragment">
<p>Each function operates either on rows, columns, groups, or entire tables.</p>
</div>
<div class="fragment">
<p>To save the transformations you’ve made to a data frame you’ll need to save the output to a new object.</p>
</div>
</section></section>
<section>
<section id="subsetting-data" class="title-slide slide level1 section-title center" data-background-color="#99a486">
<h1>Subsetting data</h1>

</section>
<section id="subset-rows-filter" class="slide level2">
<h2>Subset Rows: <code>filter()</code></h2>
<p>We often get <em>big</em> datasets, and we only want some of the entries. We can subset rows using <code>filter()</code>.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-18"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-18-1"><a href="#annotated-cell-18-1"></a>delay_2hr <span class="ot">&lt;-</span> flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1">1</button><span id="annotated-cell-18-2" class="code-annotation-target"><a href="#annotated-cell-18-2"></a>  <span class="fu">filter</span>(dep_delay <span class="sc">&gt;</span> <span class="dv">120</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="2">2</button><span id="annotated-cell-18-3" class="code-annotation-target"><a href="#annotated-cell-18-3"></a>delay_2hr</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="2" data-code-annotation="1">Here’s where all your new knowledge about logical operators comes in handy! Make sure to use <code>==</code> not <code>=</code> to test the logical condition.</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="3" data-code-annotation="2">Now, <code>delay_2hr</code> is an object in our environment which contains rows corresponding to flights that experienced at least a 2 hour delay.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,723 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      848           1835       853     1001           1950
 2  2013     1     1      957            733       144     1056            853
 3  2013     1     1     1114            900       134     1447           1222
 4  2013     1     1     1540           1338       122     2020           1825
 5  2013     1     1     1815           1325       290     2120           1542
 6  2013     1     1     1842           1422       260     1958           1535
 7  2013     1     1     1856           1645       131     2212           2005
 8  2013     1     1     1934           1725       129     2126           1855
 9  2013     1     1     1938           1703       155     2109           1823
10  2013     1     1     1942           1705       157     2124           1830
# ℹ 9,713 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</section>
<section id="subset-columns-select" class="slide level2">
<h2>Subset Columns: <code>select()</code></h2>
<p>What if we want to keep every observation, but only use certain variables? Use <code>select()</code>!</p>
<div class="fragment">
<p>We can select columns by name:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-19"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-19-1"><a href="#annotated-cell-19-1"></a>flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="1">1</button><span id="annotated-cell-19-2" class="code-annotation-target"><a href="#annotated-cell-19-2"></a>  <span class="fu">select</span>(year, month, day)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-19" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="2" data-code-annotation="1">You can use a <code>-</code> before a variable name or a vector of variables to drop them from the data (i.e.&nbsp;<br> <code>select(-c(year, month, day))</code>).</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 3
    year month   day
   &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1  2013     1     1
 2  2013     1     1
 3  2013     1     1
 4  2013     1     1
 5  2013     1     1
 6  2013     1     1
 7  2013     1     1
 8  2013     1     1
 9  2013     1     1
10  2013     1     1
# ℹ 336,766 more rows</code></pre>
</div>
</div>
</div>
</section>
<section id="subset-columns-select-1" class="slide level2">
<h2>Subset Columns: <code>select()</code></h2>
<p>What if we want to keep every observation, but only use certain variables? Use <code>select()</code>!</p>
<p>We can select columns between variables (inclusive):</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-20"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-20-1"><a href="#annotated-cell-20-1"></a>flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1">1</button><span id="annotated-cell-20-2" class="code-annotation-target"><a href="#annotated-cell-20-2"></a>  <span class="fu">select</span>(year<span class="sc">:</span>day)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="2" data-code-annotation="1">Add a <code>!</code> before <code>year</code> and you’ll drop this group of variables from the data.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 3
    year month   day
   &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1  2013     1     1
 2  2013     1     1
 3  2013     1     1
 4  2013     1     1
 5  2013     1     1
 6  2013     1     1
 7  2013     1     1
 8  2013     1     1
 9  2013     1     1
10  2013     1     1
# ℹ 336,766 more rows</code></pre>
</div>
</div>
</section>
<section id="subset-columns-select-2" class="slide level2">
<h2>Subset Columns: <code>select()</code></h2>
<p>What if we want to keep every observation, but only use certain variables? Use <code>select()</code>!</p>
<p>We can select columns based on a condition:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-21"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-21-1"><a href="#annotated-cell-21-1"></a>flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="1">1</button><span id="annotated-cell-21-2" class="code-annotation-target"><a href="#annotated-cell-21-2"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.character))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-21" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="2" data-code-annotation="1">There are a number of helper functions you can use with <code>select()</code> including <code>starts_with()</code>, <code>ends_with()</code>, <code>contains()</code> and <code>num_range()</code>. Read more about these and more <a href="https://tidyselect.r-lib.org/reference/index.html">here</a>.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 4
   carrier tailnum origin dest 
   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
 1 UA      N14228  EWR    IAH  
 2 UA      N24211  LGA    IAH  
 3 AA      N619AA  JFK    MIA  
 4 B6      N804JB  JFK    BQN  
 5 DL      N668DN  LGA    ATL  
 6 UA      N39463  EWR    ORD  
 7 B6      N516JB  EWR    FLL  
 8 EV      N829AS  LGA    IAD  
 9 B6      N593JB  JFK    MCO  
10 AA      N3ALAA  LGA    ORD  
# ℹ 336,766 more rows</code></pre>
</div>
</div>
</section>
<section id="finding-unique-rows-distinct" class="slide level2">
<h2>Finding Unique Rows: <code>distinct()</code></h2>
<p>You may want to find the unique combinations of variables in a dataset. Use <code>distinct()</code></p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-22"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-22-1"><a href="#annotated-cell-22-1"></a>flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-22" data-target-annotation="1">1</button><span id="annotated-cell-22-2" class="code-annotation-target"><a href="#annotated-cell-22-2"></a>  <span class="fu">distinct</span>(origin, dest)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-22" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-22" data-code-lines="2" data-code-annotation="1">Find all unique origin and destination pairs.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 2
   origin dest 
   &lt;chr&gt;  &lt;chr&gt;
 1 EWR    IAH  
 2 LGA    IAH  
 3 JFK    MIA  
 4 JFK    BQN  
 5 LGA    ATL  
 6 EWR    ORD  
 7 EWR    FLL  
 8 LGA    IAD  
 9 JFK    MCO  
10 LGA    ORD  
# ℹ 214 more rows</code></pre>
</div>
</div>
</div>
</section>
<section id="distinct-drops-variables" class="slide level2">
<h2><code>distinct()</code> drops variables!</h2>
<p>By default, <code>distinct()</code> drops unused variables. If you don’t want to drop them, add the argument <code>.keep_all = TRUE</code>:</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-23"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-23-1"><a href="#annotated-cell-23-1"></a>flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="1">1</button><span id="annotated-cell-23-2" class="code-annotation-target"><a href="#annotated-cell-23-2"></a>  <span class="fu">distinct</span>(origin, dest, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-23" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="2" data-code-annotation="1">It’s not a coincidence that all of these distinct flights are on January 1: <code>distinct()</code> will find the first occurrence of a unique row in the dataset and discard the rest. Use <code>count()</code> if you’re looking for the number of occurrences.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 214 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</section>
<section id="count-unique-rows-count" class="slide level2">
<h2>Count Unique Rows: <code>count()</code></h2>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-24"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-24-1"><a href="#annotated-cell-24-1"></a>flights <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="1">1</button><span id="annotated-cell-24-2" class="code-annotation-target"><a href="#annotated-cell-24-2"></a>  <span class="fu">count</span>(origin, dest, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-24" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="2" data-code-annotation="1"><code>sort = TRUE</code> arranges them in descending order of number of occurrences.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 3
   origin dest      n
   &lt;chr&gt;  &lt;chr&gt; &lt;int&gt;
 1 JFK    LAX   11262
 2 LGA    ATL   10263
 3 LGA    ORD    8857
 4 JFK    SFO    8204
 5 LGA    CLT    6168
 6 EWR    ORD    6100
 7 JFK    BOS    5898
 8 LGA    MIA    5781
 9 JFK    MCO    5464
10 EWR    BOS    5327
# ℹ 214 more rows</code></pre>
</div>
</div>
</div>
</section></section>
<section>
<section id="modifying-data" class="title-slide slide level1 section-title center" data-background-color="#99a486">
<h1>Modifying data</h1>

</section>
<section id="sorting-data-by-rows-arrange" class="slide level2">
<h2>Sorting Data by Rows: <code>arrange()</code></h2>
<p>Sometimes it’s useful to sort rows in your data, in ascending (low to high) or descending (high to low) order. We do that with <code>arrange()</code>.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-25"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-25-1"><a href="#annotated-cell-25-1"></a>flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="1">1</button><span id="annotated-cell-25-2" class="code-annotation-target"><a href="#annotated-cell-25-2"></a>  <span class="fu">arrange</span>(year, month, day, dep_time)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-25" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-25" data-code-lines="2" data-code-annotation="1">If you provide more than one column name, each additional column will be used to break ties in the values of preceding columns.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</section>
<section id="sorting-data-by-rows-arrange-1" class="slide level2">
<h2>Sorting Data by Rows: <code>arrange()</code></h2>
<p>To sort in descending order, using <code>desc()</code> within <code>arrange()</code></p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dep_delay))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     9      641            900      1301     1242           1530
 2  2013     6    15     1432           1935      1137     1607           2120
 3  2013     1    10     1121           1635      1126     1239           1810
 4  2013     9    20     1139           1845      1014     1457           2210
 5  2013     7    22      845           1600      1005     1044           1815
 6  2013     4    10     1100           1900       960     1342           2211
 7  2013     3    17     2321            810       911      135           1020
 8  2013     6    27      959           1900       899     1236           2226
 9  2013     7    22     2257            759       898      121           1026
10  2013    12     5      756           1700       896     1058           2020
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</section>
<section id="rename-variables-rename" class="slide level2">
<h2>Rename Variables: <code>rename()</code></h2>
<p>You may receive data with unintuitive variable names. Change them using <code>rename()</code>.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-27"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-27-1"><a href="#annotated-cell-27-1"></a>flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="1">1</button><span id="annotated-cell-27-2" class="code-annotation-target"><a href="#annotated-cell-27-2"></a>  <span class="fu">rename</span>(<span class="at">tail_num =</span> tailnum)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-27" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="2" data-code-annotation="1"><code>rename(new_name = old_name)</code> is the format. Reminder to use <code>janitor::clean_names()</code> if you want to automate this process for a lot of variables.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tail_num &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="callout callout-caution no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong><span style="color:tomato"><i class="fa-solid fa-exclamation-triangle" aria-label="exclamation-triangle"></i></span> Variable Syntax</strong></p>
</div>
<div class="callout-content">
<p>I recommend <strong>against</strong> using spaces in a name! It makes things <em>really hard</em> sometimes!!</p>
</div>
</div>
</div>
</div>
</section>
<section id="create-new-columns-mutate" class="slide level2">
<h2>Create New Columns: <code>mutate()</code></h2>
<p>You can add new columns to a data frame using <code>mutate()</code>.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-28"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-28-1"><a href="#annotated-cell-28-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-28-2"><a href="#annotated-cell-28-2"></a>  <span class="fu">mutate</span>(</span>
<span id="annotated-cell-28-3"><a href="#annotated-cell-28-3"></a>    <span class="at">gain =</span> dep_delay <span class="sc">-</span> arr_delay,</span>
<span id="annotated-cell-28-4"><a href="#annotated-cell-28-4"></a>    <span class="at">speed =</span> distance <span class="sc">/</span> air_time <span class="sc">*</span> <span class="dv">60</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="1">1</button><span id="annotated-cell-28-5" class="code-annotation-target"><a href="#annotated-cell-28-5"></a>    <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="annotated-cell-28-6"><a href="#annotated-cell-28-6"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-28" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="5" data-code-annotation="1">By default, <code>mutate()</code> adds new columns on the right hand side of your dataset, which makes it difficult to see if anything happened. You can use the <code>.before</code> argument to specify which numeric index (or variable name) to move the newly created variable to. <code>.after</code> is an alternative argument for this.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 21
    gain speed  year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1    -9  370.  2013     1     1      517            515         2      830
 2   -16  374.  2013     1     1      533            529         4      850
 3   -31  408.  2013     1     1      542            540         2      923
 4    17  517.  2013     1     1      544            545        -1     1004
 5    19  394.  2013     1     1      554            600        -6      812
 6   -16  288.  2013     1     1      554            558        -4      740
 7   -24  404.  2013     1     1      555            600        -5      913
 8    11  259.  2013     1     1      557            600        -3      709
 9     5  405.  2013     1     1      557            600        -3      838
10   -10  319.  2013     1     1      558            600        -2      753
# ℹ 336,766 more rows
# ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</section>
<section id="specifying-variables-to-keep-mutate" class="slide level2">
<h2>Specifying Variables to Keep: <code>mutate()</code></h2>
<p>You can specify which columns to keep with the <code>.keep</code> argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-29"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-29-1"><a href="#annotated-cell-29-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-29-2"><a href="#annotated-cell-29-2"></a>  <span class="fu">mutate</span>(</span>
<span id="annotated-cell-29-3"><a href="#annotated-cell-29-3"></a>    <span class="at">gain =</span> dep_delay <span class="sc">-</span> arr_delay,</span>
<span id="annotated-cell-29-4"><a href="#annotated-cell-29-4"></a>    <span class="at">hours =</span> air_time <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="annotated-cell-29-5"><a href="#annotated-cell-29-5"></a>    <span class="at">gain_per_hour =</span> gain <span class="sc">/</span> hours,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-29" data-target-annotation="1">1</button><span id="annotated-cell-29-6" class="code-annotation-target"><a href="#annotated-cell-29-6"></a>    <span class="at">.keep =</span> <span class="st">"used"</span></span>
<span id="annotated-cell-29-7"><a href="#annotated-cell-29-7"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-29" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-29" data-code-lines="6" data-code-annotation="1"><code>"used"</code> retains only the variables used to create the new variables, which is useful for checking your work. Other options include: <code>"all"</code> (default, returns all columns), <code>"unused"</code> (columns not used to create new columns) and <code>"none"</code> (only grouping variables and columns created by mutate are retained).</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 6
   dep_delay arr_delay air_time  gain hours gain_per_hour
       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
 1         2        11      227    -9 3.78          -2.38
 2         4        20      227   -16 3.78          -4.23
 3         2        33      160   -31 2.67         -11.6 
 4        -1       -18      183    17 3.05           5.57
 5        -6       -25      116    19 1.93           9.83
 6        -4        12      150   -16 2.5           -6.4 
 7        -5        19      158   -24 2.63          -9.11
 8        -3       -14       53    11 0.883         12.5 
 9        -3        -8      140     5 2.33           2.14
10        -2         8      138   -10 2.3           -4.35
# ℹ 336,766 more rows</code></pre>
</div>
</div>
</section>
<section id="move-variables-around-relocate" class="slide level2">
<h2>Move Variables Around: <code>relocate()</code></h2>
<p>You might want to collect related variables together or move important variables to the front. Use <code>relocate()</code>!</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-30"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-30-1"><a href="#annotated-cell-30-1"></a>flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="1">1</button><span id="annotated-cell-30-2" class="code-annotation-target"><a href="#annotated-cell-30-2"></a>  <span class="fu">relocate</span>(time_hour, air_time)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-30" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="2" data-code-annotation="1">By default <code>relocate()</code> moves variables to the front but you can also specify where to put them using the <code>.before</code> and <code>.after</code> arguments, just like in <code>mutate()</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
   time_hour           air_time  year month   day dep_time sched_dep_time
   &lt;dttm&gt;                 &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
 1 2013-01-01 05:00:00      227  2013     1     1      517            515
 2 2013-01-01 05:00:00      227  2013     1     1      533            529
 3 2013-01-01 05:00:00      160  2013     1     1      542            540
 4 2013-01-01 05:00:00      183  2013     1     1      544            545
 5 2013-01-01 06:00:00      116  2013     1     1      554            600
 6 2013-01-01 05:00:00      150  2013     1     1      554            558
 7 2013-01-01 06:00:00      158  2013     1     1      555            600
 8 2013-01-01 06:00:00       53  2013     1     1      557            600
 9 2013-01-01 06:00:00      140  2013     1     1      557            600
10 2013-01-01 06:00:00      138  2013     1     1      558            600
# ℹ 336,766 more rows
# ℹ 12 more variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;,
#   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#   dest &lt;chr&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;</code></pre>
</div>
</div>
</section></section>
<section>
<section id="summarizing-data" class="title-slide slide level1 section-title center" data-background-color="#99a486">
<h1>Summarizing data</h1>

</section>
<section id="grouping-data-group_by" class="slide level2">
<h2>Grouping Data: <code>group_by()</code></h2>
<p>If you want to analyze your data by specific groupings, use <code>group_by()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-31"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-31-1"><a href="#annotated-cell-31-1"></a>flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-31" data-target-annotation="1">1</button><span id="annotated-cell-31-2" class="code-annotation-target"><a href="#annotated-cell-31-2"></a>  <span class="fu">group_by</span>(month)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-31" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-31" data-code-lines="2" data-code-annotation="1"><code>group_by()</code> doesn’t change the data but you’ll notice that the output indicates that it is “grouped by” month <code>(Groups: month [12])</code>. This means subsequent operations will now work “by month”.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
# Groups:   month [12]
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="summarizing-data-summarize" class="slide level2">
<h2>Summarizing Data: <code>summarize()</code></h2>
<p><strong><code>summarize()</code></strong> calculates summaries of variables in your data:</p>
<ul>
<li class="fragment">Count the number of rows</li>
<li class="fragment">Calculate the mean</li>
<li class="fragment">Calculate the sum</li>
<li class="fragment">Find the minimum or maximum value</li>
</ul>
<div class="fragment">
<p>You can use any function inside <code>summarize()</code> that aggregates <em>multiple values</em> into a <em>single value</em> (like <code>sd()</code>, <code>mean()</code>, or <code>max()</code>).</p>
</div>
</section>
<section id="summarize-example" class="slide level2">
<h2><code>summarize()</code> Example</h2>
<p>Let’s see what this looks like in our flights dataset:</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-32"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-32-1"><a href="#annotated-cell-32-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-32-2"><a href="#annotated-cell-32-2"></a>  <span class="fu">summarize</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="1">1</button><span id="annotated-cell-32-3" class="code-annotation-target"><a href="#annotated-cell-32-3"></a>    <span class="at">avg_delay =</span> <span class="fu">mean</span>(dep_delay)</span>
<span id="annotated-cell-32-4"><a href="#annotated-cell-32-4"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-32" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="3" data-code-annotation="1">The <code>NA</code> produced here is a result of calling <code>mean</code> on <code>dep_delay</code>. Any summarizing function will return <code>NA</code> if <strong>any</strong> of the values are <code>NA</code>. We can set <code>na.rm = TRUE</code> to change this behavior.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  avg_delay
      &lt;dbl&gt;
1        NA</code></pre>
</div>
</div>
</div>
</section>
<section id="summarize-example-1" class="slide level2">
<h2><code>summarize()</code> Example</h2>
<p>Let’s see what this looks like in our flights dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a></a>  <span class="fu">summarize</span>(</span>
<span id="cb33-3"><a></a>    <span class="at">avg_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) </span>
<span id="cb33-4"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  avg_delay
      &lt;dbl&gt;
1      12.6</code></pre>
</div>
</div>
</section>
<section id="summarizing-data-by-groups" class="slide level2">
<h2>Summarizing Data by Groups</h2>
<p>What if we want to summarize data by our groups? Use <code>group_by()</code> <strong>and</strong> <code>summarize()</code></p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a></a>  <span class="fu">summarize</span>(</span>
<span id="cb35-4"><a></a>    <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-5"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   month delay
   &lt;int&gt; &lt;dbl&gt;
 1     1 10.0 
 2     2 10.8 
 3     3 13.2 
 4     4 13.9 
 5     5 13.0 
 6     6 20.8 
 7     7 21.7 
 8     8 12.6 
 9     9  6.72
10    10  6.24
11    11  5.44
12    12 16.6 </code></pre>
</div>
</div>
</div>
<div class="fragment">
<p>Because we did <code>group_by()</code> <em>with</em> <code>month</code>, <em>then</em> used <code>summarize()</code>, we get <strong>one row per value of <code>month</code></strong>!</p>
</div>
</section>
<section id="summarizing-data-by-groups-1" class="slide level2">
<h2>Summarizing Data by Groups</h2>
<p>You can create any number of summaries in a single call to summarize().</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-35"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-35-1"><a href="#annotated-cell-35-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-35-2"><a href="#annotated-cell-35-2"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-35-3"><a href="#annotated-cell-35-3"></a>  <span class="fu">summarize</span>(</span>
<span id="annotated-cell-35-4"><a href="#annotated-cell-35-4"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="1">1</button><span id="annotated-cell-35-5" class="code-annotation-target"><a href="#annotated-cell-35-5"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="annotated-cell-35-6"><a href="#annotated-cell-35-6"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-35" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="5" data-code-annotation="1"><code>n()</code> returns the number of rows in each group.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   month delay     n
   &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
 1     1 10.0  27004
 2     2 10.8  24951
 3     3 13.2  28834
 4     4 13.9  28330
 5     5 13.0  28796
 6     6 20.8  28243
 7     7 21.7  29425
 8     8 12.6  29327
 9     9  6.72 27574
10    10  6.24 28889
11    11  5.44 27268
12    12 16.6  28135</code></pre>
</div>
</div>
</section>
<section id="grouping-by-multiple-variables" class="slide level2 scrollable">
<h2>Grouping by Multiple Variables <span style="color:#99a486"><i class="fa-solid fa-scroll" aria-label="scroll"></i></span></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a>daily <span class="ot">&lt;-</span> flights <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a></a>  <span class="fu">group_by</span>(year, month, day)  </span>
<span id="cb38-3"><a></a>daily</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
# Groups:   year, month, day [365]
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<div class="fragment">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong><span style="color:green"><i class="fa-solid fa-info-circle" aria-label="info-circle"></i></span> Summary &amp; Grouping Behavior</strong></p>
</div>
<div class="callout-content">
<p>When you summarize a tibble grouped by more than one variable, each summary peels off the last group. You can change the default behavior by setting the <code>.groups</code> argument to a different value, e.g., <code>"drop"</code> to drop all grouping or <code>"keep"</code> to preserve the same groups. The default is <code>"drop_last"</code> if all groups have 1 row and <code>keep</code> otherwise (it’s recommended to use <code>reframe()</code> if this is the case, which is a more general version of <code>summarize()</code> that allows for an arbitrary number of rows per group and drops all grouping variables after execution).</p>
</div>
</div>
</div>
</div>
</section>
<section id="remove-grouping-ungroup" class="slide level2">
<h2>Remove Grouping: <code>ungroup()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a>daily <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a></a>  <span class="fu">ungroup</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="newer-alternative-for-grouping-.by" class="slide level2">
<h2>Newer Alternative for Grouping: <code>.by</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-38"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-38-1"><a href="#annotated-cell-38-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-38-2"><a href="#annotated-cell-38-2"></a>  <span class="fu">summarize</span>(</span>
<span id="annotated-cell-38-3"><a href="#annotated-cell-38-3"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="annotated-cell-38-4"><a href="#annotated-cell-38-4"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-38" data-target-annotation="1">1</button><span id="annotated-cell-38-5" class="code-annotation-target"><a href="#annotated-cell-38-5"></a>    <span class="at">.by =</span> month</span>
<span id="annotated-cell-38-6"><a href="#annotated-cell-38-6"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-38" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-38" data-code-lines="5" data-code-annotation="1"><code>.by</code> works with all verbs and has the advantage that you don’t need to use the <code>.groups</code> argument to suppress the grouping message or <code>ungroup()</code> when you’re done.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   month delay     n
   &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
 1     1 10.0  27004
 2    10  6.24 28889
 3    11  5.44 27268
 4    12 16.6  28135
 5     2 10.8  24951
 6     3 13.2  28834
 7     4 13.9  28330
 8     5 13.0  28796
 9     6 20.8  28243
10     7 21.7  29425
11     8 12.6  29327
12     9  6.72 27574</code></pre>
</div>
</div>
</section>
<section id="select-specific-rows-per-group-slice_" class="slide level2">
<h2>Select Specific Rows Per Group: <code>slice_*</code></h2>
<p>There are five handy functions that allow you extract specific rows within each group:</p>
<ul>
<li class="fragment"><code>df |&gt; slice_head(n = 1)</code> takes the first row from each group.</li>
<li class="fragment"><code>df |&gt; slice_tail(n = 1)</code> takes the last row in each group.</li>
<li class="fragment"><code>df |&gt; slice_min(x, n = 1)</code> takes the row with the smallest value of column x.</li>
<li class="fragment"><code>df |&gt; slice_max(x, n = 1)</code> takes the row with the largest value of column x.</li>
<li class="fragment"><code>df |&gt; slice_sample(n = 1)</code> takes one random row.</li>
</ul>
<div class="fragment">
<p>Let’s find the flights that are most delayed upon arrival at each destination.</p>
</div>
</section>
<section id="select-specific-rows-per-group-slice_-1" class="slide level2">
<h2>Select Specific Rows Per Group: <code>slice_*</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-39"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-39-1"><a href="#annotated-cell-39-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-39-2"><a href="#annotated-cell-39-2"></a>  <span class="fu">group_by</span>(dest) <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-39" data-target-annotation="1">1</button><span id="annotated-cell-39-3" class="code-annotation-target"><a href="#annotated-cell-39-3"></a>  <span class="fu">slice_max</span>(arr_delay, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-39-4"><a href="#annotated-cell-39-4"></a>  <span class="fu">relocate</span>(dest, arr_delay) </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-39" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-39" data-code-lines="3" data-code-annotation="1">You can vary <code>n</code> to select more than one row, or instead of <code>n</code>, you can use <code>prop</code> to select a proportion (between 0 and 1) of the rows in each group.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 108 × 19
# Groups:   dest [105]
   dest  arr_delay  year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1 ABQ         153  2013     7    22     2145           2007        98      132
 2 ACK         221  2013     7    23     1139            800       219     1250
 3 ALB         328  2013     1    25      123           2000       323      229
 4 ANC          39  2013     8    17     1740           1625        75     2042
 5 ATL         895  2013     7    22     2257            759       898      121
 6 AUS         349  2013     7    10     2056           1505       351     2347
 7 AVL         228  2013     8    13     1156            832       204     1417
 8 BDL         266  2013     2    21     1728           1316       252     1839
 9 BGR         238  2013    12     1     1504           1056       248     1628
10 BHM         291  2013     4    10       25           1900       325      136
# ℹ 98 more rows
# ℹ 10 more variables: sched_arr_time &lt;int&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>

<aside><div>
<p><span class="fragment">There are 105 groups but 108 rows! Why? <code>slice_min()</code> and <code>slice_max()</code> keep tied values so <code>n = 1</code> means “give us all rows with the highest value.” If you want exactly one row per group you can set <code>with_ties = FALSE</code>.</span></p>
</div></aside></section></section>
<section>
<section id="lab" class="title-slide slide level1 section-title center" data-background-color="#99a486">
<h1>Lab</h1>

</section>
<section id="manipulating-data" class="slide level2">
<h2>Manipulating Data</h2>
<ol type="1">
<li>Create a new object that contains the following from <code>gapminder</code><sup>1</sup>
<ol type="i">
<li>observations from China, India, and United States after 1980, <em>and</em></li>
<li>variables corresponding to country, year, population, and life expectancy.</li>
</ol></li>
<li>How many rows and columns does the object contain?</li>
<li>Sort the rows by <code>year</code> (ascending order) and <code>population</code> (descending order) and save that over (i.e.&nbsp;overwrite) the object created for answer 1. Print the first 6 rows.</li>
<li>Create a new variable that contains population in billions.</li>
<li>By year, calculate the total population (in billions) across these three countries</li>
<li>In <code>ggplot</code>, create a line plot showing life expectancy over time by country. Make the plot visually appealing!</li>
</ol>
<aside><ol class="aside-footnotes"><li id="fn6"><p>Using the <code>gapminder</code> package</p></li></ol></aside></section>





</section>
<section>
<section id="merging-data" class="title-slide slide level1 section-title center" data-background-color="#99a486">
<h1>Merging Data</h1>

</section>
<section id="why-merge-data" class="slide level2">
<h2>Why Merge Data?</h2>
<p>In practice, we often collect data from different sources. To analyze the data, we usually must first combine (merge) them.</p>
<div class="fragment">
<p>For example, imagine you would like to study county-level patterns with respect to age and grocery spending. However, you can only find,</p>
<ul>
<li>County level age data from the US Census, and</li>
<li>County level grocery spending data from the US Department of Agriculture</li>
</ul>
</div>
<div class="fragment">
<p>Merge the data!!</p>
</div>
<div class="fragment">
<p>To do this we’ll be using the various <strong>join</strong> functions from the <code>dplyr</code> package.</p>
</div>
</section>
<section id="joining-in-concept" class="slide level2">
<h2>Joining in Concept</h2>
<p>We need to think about the following when we want to merge data frames A and B:</p>
<div class="fragment">
<ul>
<li>Which rows are we keeping from each data frame?</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Which columns are we keeping from each data frame?</li>
</ul>
</div>
<div class="fragment fade-in">
<div class="fragment highlight-red">
<ul>
<li>Which variables determine whether rows match?</li>
</ul>
</div>
</div>
</section>
<section id="keys" class="slide level2">
<h2>Keys</h2>
<p>Keys are the way that two datasets are connected to one another. The two types of keys are:</p>
<ol type="1">
<li class="fragment"><strong>Primary</strong>: a variable or set of variables that uniquely identifies each observation.
<ol type="i">
<li class="fragment">When more than one variable makes up the primary key it’s called a <strong>compound key</strong></li>
</ol></li>
<li class="fragment"><strong>Foreign</strong>: a variable (or set of variables) that corresponds to a primary key in another table.</li>
</ol>
</section>
<section class="slide level2">

<h3 id="primary-keys">Primary Keys</h3>
<p><span style="font-size: 80%;">Let’s look at our data to gain a better sense of what this all means.</span></p>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1"><code>airlines</code></a></li><li><a href="#tabset-3-2"><code>airports</code></a></li><li><a href="#tabset-3-3"><code>planes</code></a></li><li><a href="#tabset-3-4"><code>weather</code></a></li><li><a href="#tabset-3-5"><code>flights</code></a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<p><span style="font-size: 80%;"><code>airlines</code> records two pieces of data about each airline: its carrier code and its full name. You can identify an airline with its two letter carrier code, making <code>carrier</code> the primary key.</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-106"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-106" data-target-annotation="1">1</button><span id="annotated-cell-106-1" class="code-annotation-target"><a href="#annotated-cell-106-1"></a><span class="fu">glimpse</span>(airlines)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-106" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-106" data-code-lines="1" data-code-annotation="1">Use <code>glimpse</code> on any dataset to see a transposed version of the data, making it possible to see all available column names, types, and a preview of as many values will fit on your current screen.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 16
Columns: 2
$ carrier &lt;chr&gt; "9E", "AA", "AS", "B6", "DL", "EV", "F9", "FL", "HA", "MQ", "O…
$ name    &lt;chr&gt; "Endeavor Air Inc.", "American Airlines Inc.", "Alaska Airline…</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2">
<p><span style="font-size: 80%;"><code>airports</code> records data about each airport. You can identify each airport by its three letter airport code, making <code>faa</code> the primary key.</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a></a><span class="fu">glimpse</span>(airports)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,458
Columns: 8
$ faa   &lt;chr&gt; "04G", "06A", "06C", "06N", "09J", "0A9", "0G6", "0G7", "0P2", "…
$ name  &lt;chr&gt; "Lansdowne Airport", "Moton Field Municipal Airport", "Schaumbur…
$ lat   &lt;dbl&gt; 41.13047, 32.46057, 41.98934, 41.43191, 31.07447, 36.37122, 41.4…
$ lon   &lt;dbl&gt; -80.61958, -85.68003, -88.10124, -74.39156, -81.42778, -82.17342…
$ alt   &lt;dbl&gt; 1044, 264, 801, 523, 11, 1593, 730, 492, 1000, 108, 409, 875, 10…
$ tz    &lt;dbl&gt; -5, -6, -6, -5, -5, -5, -5, -5, -5, -8, -5, -6, -5, -5, -5, -5, …
$ dst   &lt;chr&gt; "A", "A", "A", "A", "A", "A", "A", "A", "U", "A", "A", "U", "A",…
$ tzone &lt;chr&gt; "America/New_York", "America/Chicago", "America/Chicago", "Ameri…</code></pre>
</div>
</div>
</div>
<div id="tabset-3-3">
<p><span style="font-size: 80%;"><code>planes</code> records data about each plane. You can identify a plane by its tail number, making <code>tailnum</code> the primary key.</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a></a><span class="fu">glimpse</span>(planes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3,322
Columns: 9
$ tailnum      &lt;chr&gt; "N10156", "N102UW", "N103US", "N104UW", "N10575", "N105UW…
$ year         &lt;int&gt; 2004, 1998, 1999, 1999, 2002, 1999, 1999, 1999, 1999, 199…
$ type         &lt;chr&gt; "Fixed wing multi engine", "Fixed wing multi engine", "Fi…
$ manufacturer &lt;chr&gt; "EMBRAER", "AIRBUS INDUSTRIE", "AIRBUS INDUSTRIE", "AIRBU…
$ model        &lt;chr&gt; "EMB-145XR", "A320-214", "A320-214", "A320-214", "EMB-145…
$ engines      &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
$ seats        &lt;int&gt; 55, 182, 182, 182, 55, 182, 182, 182, 182, 182, 55, 55, 5…
$ speed        &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ engine       &lt;chr&gt; "Turbo-fan", "Turbo-fan", "Turbo-fan", "Turbo-fan", "Turb…</code></pre>
</div>
</div>
</div>
<div id="tabset-3-4">
<p><span style="font-size: 80%;"><code>weather</code> records data about the weather at the origin airports. You can identify each observation by the combination of location and time, making <code>origin</code> and <code>time_hour</code> the compound primary key.</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a></a><span class="fu">glimpse</span>(weather)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 26,115
Columns: 15
$ origin     &lt;chr&gt; "EWR", "EWR", "EWR", "EWR", "EWR", "EWR", "EWR", "EWR", "EW…
$ year       &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013,…
$ month      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ day        &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ hour       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 14, 15, 16, 17, 18, …
$ temp       &lt;dbl&gt; 39.02, 39.02, 39.02, 39.92, 39.02, 37.94, 39.02, 39.92, 39.…
$ dewp       &lt;dbl&gt; 26.06, 26.96, 28.04, 28.04, 28.04, 28.04, 28.04, 28.04, 28.…
$ humid      &lt;dbl&gt; 59.37, 61.63, 64.43, 62.21, 64.43, 67.21, 64.43, 62.21, 62.…
$ wind_dir   &lt;dbl&gt; 270, 250, 240, 250, 260, 240, 240, 250, 260, 260, 260, 330,…
$ wind_speed &lt;dbl&gt; 10.35702, 8.05546, 11.50780, 12.65858, 12.65858, 11.50780, …
$ wind_gust  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 20.…
$ precip     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ pressure   &lt;dbl&gt; 1012.0, 1012.3, 1012.5, 1012.2, 1011.9, 1012.4, 1012.2, 101…
$ visib      &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,…
$ time_hour  &lt;dttm&gt; 2013-01-01 01:00:00, 2013-01-01 02:00:00, 2013-01-01 03:00…</code></pre>
</div>
</div>
</div>
<div id="tabset-3-5">
<p><span style="font-size: 80%;"><code>flights</code> has three variables (<code>time_hour</code>, <code>flight</code>, <code>carrier</code>) that uniquely identify an observation. More significantly, however, it contains <strong>foreign keys</strong> that correspond to the primary keys of the other datasets.</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a></a><span class="fu">glimpse</span>(flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 336,776
Columns: 19
$ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2…
$ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, …
$ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, …
$ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1…
$ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,…
$ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,…
$ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1…
$ carrier        &lt;chr&gt; "UA", "UA", "AA", "B6", "DL", "UA", "B6", "EV", "B6", "…
$ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4…
$ tailnum        &lt;chr&gt; "N14228", "N24211", "N619AA", "N804JB", "N668DN", "N394…
$ origin         &lt;chr&gt; "EWR", "LGA", "JFK", "JFK", "LGA", "EWR", "EWR", "LGA",…
$ dest           &lt;chr&gt; "IAH", "IAH", "MIA", "BQN", "ATL", "ORD", "FLL", "IAD",…
$ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1…
$ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, …
$ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6…
$ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0…
$ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0…</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="foreign-keys" class="slide level2">
<h2>Foreign Keys</h2>

<img data-src="images/relational.png" class="r-stretch quarto-figure-center"><p class="caption">Note: grey shading indicates the primary key for that particular dataset.</p><ul>
<li class="fragment"><code>flights$origin</code> –&gt; <code>airports$faa</code></li>
<li class="fragment"><code>flights$dest</code> –&gt; <code>airports$faa</code></li>
<li class="fragment"><code>flights$origin</code>-<code>flights$time_hour</code> –&gt; <code>weather$origin</code>-<code>weather$time_hour</code>.</li>
<li class="fragment"><code>flights$tailnum</code> –&gt; <code>planes$tailnum</code></li>
<li class="fragment"><code>flights$carrier</code> –&gt; <code>airlines$carrier</code></li>
</ul>
</section>
<section id="checking-keys" class="slide level2">
<h2>Checking Keys</h2>
<p>A nice feature of these data are that the primary and foreign keys have the same name and almost every variable name used across multiple tables has the same meaning.<sup>1</sup> This isn’t always the case!<sup>2</sup></p>
<div class="fragment">
<p>It is good practice to make sure your primary keys actually uniquely identify an observation and that they don’t have any missing values.</p>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-46"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-46-1"><a href="#annotated-cell-46-1"></a>planes <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-46" data-target-annotation="1">1</button><span id="annotated-cell-46-2" class="code-annotation-target"><a href="#annotated-cell-46-2"></a>  <span class="fu">count</span>(tailnum) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-46-3"><a href="#annotated-cell-46-3"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-46" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-46" data-code-lines="2,3" data-code-annotation="1">If your primary keys uniquely identify each observation you’ll get an empty tibble in return.</span>
</dd>
</dl>
</div>
</div>
<div class="cell fragment">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: tailnum &lt;chr&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-47"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-47-1"><a href="#annotated-cell-47-1"></a>planes <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-47" data-target-annotation="2">2</button><span id="annotated-cell-47-2" class="code-annotation-target"><a href="#annotated-cell-47-2"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(tailnum))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-47" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-47" data-code-lines="2" data-code-annotation="2">If none of your primary keys are missing you’ll get an empty tibble in return here too.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 9
# ℹ 9 variables: tailnum &lt;chr&gt;, year &lt;int&gt;, type &lt;chr&gt;, manufacturer &lt;chr&gt;,
#   model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</code></pre>
</div>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn7"><p>With the exception of <code>year</code>: it means year of departure in <code>flights</code> and year of manufacture in <code>planes</code>. </p></li><li id="fn8"><p>We’ll cover how to handle this shortly.</p></li></ol></aside></section>
<section id="surrogate-keys" class="slide level2">
<h2>Surrogate Keys</h2>
<p>Sometimes you’ll want to create an index of your observations to serve as a surrogate key because the compound primary key is not particularly easy to reference.</p>
<div class="fragment">
<p>For example, our <code>flights</code> dataset has three variables that uniquely identify each observation: <code>time_hour</code>, <code>carrier</code>, <code>flight</code>.</p>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-48"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-48-1"><a href="#annotated-cell-48-1"></a>flights2 <span class="ot">&lt;-</span> flights <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-48" data-target-annotation="1">1</button><span id="annotated-cell-48-2" class="code-annotation-target"><a href="#annotated-cell-48-2"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>(), <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="annotated-cell-48-3"><a href="#annotated-cell-48-3"></a>flights2</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-48" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-48" data-code-lines="2" data-code-annotation="1"><code>row_number()</code> simply specifies the row number of the data frame.</span>
</dd>
</dl>
</div>
</div>
<div class="cell fragment">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 20
      id  year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1     1  2013     1     1      517            515         2      830
 2     2  2013     1     1      533            529         4      850
 3     3  2013     1     1      542            540         2      923
 4     4  2013     1     1      544            545        -1     1004
 5     5  2013     1     1      554            600        -6      812
 6     6  2013     1     1      554            558        -4      740
 7     7  2013     1     1      555            600        -5      913
 8     8  2013     1     1      557            600        -3      709
 9     9  2013     1     1      557            600        -3      838
10    10  2013     1     1      558            600        -2      753
# ℹ 336,766 more rows
# ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</section>
<section id="basic-equi--joins" class="slide level2">
<h2>Basic (Equi-) Joins</h2>
<p>All join functions have the same basic interface: they take a <strong>pair</strong> of data frames and return <strong>one</strong> data frame.</p>
<div class="fragment">
<p>The order of the rows and columns is primarily going to be determined by the first data frame.</p>
</div>
<div class="fragment">
<p><code>dplyr</code> has two types of joins: <em>mutating</em> and <em>filtering.</em></p>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="fragment">
<h4 id="mutating-joins">Mutating Joins</h4>
<p>Add new variables to one data frame from matching observations from another data frame.</p>
<ul>
<li><code>left_join()</code></li>
<li><code>right_join()</code></li>
<li><code>inner_join()</code></li>
<li><code>full_join()</code></li>
</ul>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment">
<h4 id="filtering-joins">Filtering Joins</h4>
<p>Filter observations from one data frame based on whether or not they match an observation in another data frame.</p>
<ul>
<li><code>semi_join()</code></li>
<li><code>anti-join()</code></li>
</ul>
</div>
</div></div>
</div>
</section>
<section id="mutating-joins-1" class="slide level2">
<h2><code>Mutating Joins</code></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><br></p>
<div class="fragment">
<p><img data-src="images/joins_setup.png"></p>
</div>
</div><div class="column" style="width:50%;">
<p><br></p>
<div class="fragment">
<p><img data-src="images/joins_setup2.png"></p>
</div>
</div></div>
</section>
<section id="left_join" class="slide level2">
<h2><code>left_join()</code></h2>

<img data-src="images/joins_left.png" class="quarto-figure quarto-figure-center r-stretch"><div class="r-stack">
<p><span class="fragment fade-in-then-out absolute" data-fragment-index="1" style="top: 0px; right: 0px; ">The most common type of join</span> <span class="fragment absolute" data-fragment-index="2" style="top: 0px; right: 0px; ">Appends columns from <code>y</code> to <code>x</code> by the rows in <code>x</code><br>
(<code>NA</code> added if there is nothing from <code>y</code>)</span> <span class="fragment absolute" data-fragment-index="3" style="font-size: 80%;bottom: -225px; right: 0px; width: 500px; height: 400px; "><strong>Natural join</strong>: when all variables that appear in both datasets are used as the join key.<br>
<br>
<em>If the <code>join_by()</code> argument is not specified, <code>left_join()</code> will automatically join by all columns that have names and values in common.</em></span></p>
</div>
</section>
<section id="left_join-in-nycflights13" class="slide level2">
<h2><code>left_join</code> in <code>nycflights13</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a></a>flights2 <span class="ot">&lt;-</span> flights <span class="sc">|&gt;</span> </span>
<span id="cb72-2"><a></a>  <span class="fu">select</span>(year, time_hour, origin, dest, tailnum, carrier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With only the pertinent variables from the <code>flights</code> dataset, we can see how a <code>left_join</code> works with the <code>airlines</code> dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-50"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-50-1"><a href="#annotated-cell-50-1"></a>flights2 <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-50" data-target-annotation="1">1</button><span id="annotated-cell-50-2" class="code-annotation-target"><a href="#annotated-cell-50-2"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> airlines)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-50" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-50" data-code-lines="2" data-code-annotation="1">The <code>airlines</code> dataset has variables <code>carrier</code> and <code>name</code></span>
</dd>
</dl>
</div>
</div>
<div class="cell fragment">
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(carrier)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 7
    year time_hour           origin dest  tailnum carrier name                  
   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                 
 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      United Air Lines Inc. 
 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      United Air Lines Inc. 
 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      American Airlines Inc.
 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      JetBlue Airways       
 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      Delta Air Lines Inc.  
 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      United Air Lines Inc. 
 7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6      JetBlue Airways       
 8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV      ExpressJet Airlines I…
 9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6      JetBlue Airways       
10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      American Airlines Inc.
# ℹ 336,766 more rows</code></pre>
</div>
</div>
</section>
<section id="different-variable-meanings" class="slide level2">
<h2>Different variable meanings</h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-51"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-51-1"><a href="#annotated-cell-51-1"></a>flights2 <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-51" data-target-annotation="1">1</button><span id="annotated-cell-51-2" class="code-annotation-target"><a href="#annotated-cell-51-2"></a>  <span class="fu">left_join</span>(planes)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-51" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-51" data-code-lines="2" data-code-annotation="1">The <code>planes</code> dataset has variables <code>tailnum</code>, <code>year</code>, <code>type</code>, <code>manufacturer</code>, <code>model</code>, <code>engines</code>, <code>seats</code>, <code>speed</code>, and <code>engine</code></span>
</dd>
</dl>
</div>
</div>
<div class="cell fragment">
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(year, tailnum)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 13
    year time_hour           origin dest  tailnum carrier type  manufacturer
   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;       
 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      &lt;NA&gt;  &lt;NA&gt;        
 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      &lt;NA&gt;  &lt;NA&gt;        
 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      &lt;NA&gt;  &lt;NA&gt;        
 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      &lt;NA&gt;  &lt;NA&gt;        
 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      &lt;NA&gt;  &lt;NA&gt;        
 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      &lt;NA&gt;  &lt;NA&gt;        
 7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6      &lt;NA&gt;  &lt;NA&gt;        
 8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV      &lt;NA&gt;  &lt;NA&gt;        
 9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6      &lt;NA&gt;  &lt;NA&gt;        
10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;  &lt;NA&gt;        
# ℹ 336,766 more rows
# ℹ 5 more variables: model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;, speed &lt;int&gt;,
#   engine &lt;chr&gt;</code></pre>
</div>
</div>
<p><br>
</p>
<p><span class="fragment fade-in-then-out">When we try to do this, however, we get a bunch of <code>NA</code>s. Why?</span></p>

<aside><div>
<p><span class="fragment"><em>Join is trying to use tailnum and year as a compound key.</em> While both datasets have <code>year</code> as a variable, they mean <strong>different</strong> things. Therefore, we need to be explicit here about what to join by.</span></p>
</div></aside></section>
<section id="different-variable-meanings-1" class="slide level2">
<h2>Different variable meanings</h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-52"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-52-1"><a href="#annotated-cell-52-1"></a>flights2 <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-52" data-target-annotation="1">1</button><span id="annotated-cell-52-2" class="code-annotation-target"><a href="#annotated-cell-52-2"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> planes, <span class="at">by =</span> <span class="fu">join_by</span>(tailnum))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-52" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-52" data-code-lines="2" data-code-annotation="1"><code>join_by(tailnum)</code> is short for <code>join_by(tailnum == tailnum)</code> making these types of basic joins equi joins.</span>
</dd>
</dl>
</div>
</div>
<div class="cell fragment">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 14
   year.x time_hour           origin dest  tailnum carrier year.y type          
    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;         
 1   2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA        1999 Fixed wing mu…
 2   2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA        1998 Fixed wing mu…
 3   2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA        1990 Fixed wing mu…
 4   2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6        2012 Fixed wing mu…
 5   2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL        1991 Fixed wing mu…
 6   2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA        2012 Fixed wing mu…
 7   2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6        2000 Fixed wing mu…
 8   2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV        1998 Fixed wing mu…
 9   2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6        2004 Fixed wing mu…
10   2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA          NA &lt;NA&gt;          
# ℹ 336,766 more rows
# ℹ 6 more variables: manufacturer &lt;chr&gt;, model &lt;chr&gt;, engines &lt;int&gt;,
#   seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</code></pre>
</div>
</div>

<aside><div>
<p><span class="fragment">When you have the same variable name but they mean different things you can specify a particular suffix with the <code>suffix</code> argument in the <code>_join</code> function. By default the suffix will be <code>.x</code> for the variable from the first dataset and <code>.y</code> for the variable from the second dataset.</span></p>
</div></aside></section>
<section id="different-variable-names" class="slide level2">
<h2>Different variable names</h2>
<p>If you have keys that have the same meaning (values) but are named different things in their respective datasets you’d also specify that with <code>join_by()</code></p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-53"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-53-1"><a href="#annotated-cell-53-1"></a>flights2 <span class="sc">|&gt;</span> </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-53" data-target-annotation="1">1</button><span id="annotated-cell-53-2" class="code-annotation-target"><a href="#annotated-cell-53-2"></a>  <span class="fu">left_join</span>(airports, <span class="fu">join_by</span>(dest <span class="sc">==</span> faa))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-53" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-53" data-code-lines="2" data-code-annotation="1"><code>by = c("dest" = "faa")</code> was the former syntax for this and you still might see that in older code. You can specify multiple <code>join_by</code>s by simply separating the conditional statements with <code>,</code> (i.e.&nbsp;<code>join_by(x == y, a == b)</code>).</span>
</dd>
</dl>
</div>
</div>
<div class="cell fragment">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 13
    year time_hour           origin dest  tailnum carrier name         lat   lon
   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      George Bu…  30.0 -95.3
 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      George Bu…  30.0 -95.3
 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      Miami Intl  25.8 -80.3
 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      &lt;NA&gt;        NA    NA  
 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      Hartsfiel…  33.6 -84.4
 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      Chicago O…  42.0 -87.9
 7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6      Fort Laud…  26.1 -80.2
 8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV      Washingto…  38.9 -77.5
 9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6      Orlando I…  28.4 -81.3
10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      Chicago O…  42.0 -87.9
# ℹ 336,766 more rows
# ℹ 4 more variables: alt &lt;dbl&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
</div>
</div>

</div>
<aside><div>
<p><span class="fragment">This will match <code>dest</code> to <code>faa</code> for the join and then drop <code>faa</code>.</span></p>
</div></aside></section>
<section id="different-variable-names-1" class="slide level2">
<h2>Different variable names</h2>
<p>You can request <code>dplyr</code> to keep both keys with <code>keep = TRUE</code> argument.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a></a>flights2 <span class="sc">|&gt;</span> </span>
<span id="cb79-2"><a></a>  <span class="fu">left_join</span>(airports, <span class="fu">join_by</span>(dest <span class="sc">==</span> faa), <span class="at">keep =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell fragment">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 14
    year time_hour           origin dest  tailnum carrier faa   name         lat
   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      IAH   George Bu…  30.0
 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      IAH   George Bu…  30.0
 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      MIA   Miami Intl  25.8
 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      &lt;NA&gt;  &lt;NA&gt;        NA  
 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      ATL   Hartsfiel…  33.6
 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      ORD   Chicago O…  42.0
 7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6      FLL   Fort Laud…  26.1
 8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV      IAD   Washingto…  38.9
 9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6      MCO   Orlando I…  28.4
10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      ORD   Chicago O…  42.0
# ℹ 336,766 more rows
# ℹ 5 more variables: lon &lt;dbl&gt;, alt &lt;dbl&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
</div>
</div>
</div>
</section>
<section id="right_join" class="slide level2">
<h2><code>right_join()</code></h2>

<img data-src="images/joins_right.png" class="r-stretch quarto-figure-center"><p class="caption">Has the same interface as a <code>left_join</code> but keeps all rows in <code>y</code> instead of <code>x</code></p></section>
<section id="inner_join" class="slide level2">
<h2><code>inner_join()</code></h2>

<img data-src="images/joins_inner.png" class="r-stretch quarto-figure-center"><p class="caption">Has the same interface as a <code>left_join</code> but only keeps rows that occur in both x and y</p></section>
<section id="full_join" class="slide level2">
<h2><code>full_join()</code></h2>

<img data-src="images/joins_full.png" class="r-stretch quarto-figure-center"><p class="caption">Has the same interface as a <code>left_join</code> but keeps all rows in either x or y</p></section>
<section id="filtering-joins-1" class="slide level2">
<h2><code>Filtering Joins</code></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><br></p>
<div class="fragment">
<p><img data-src="images/joins_setup.png"></p>
</div>
</div><div class="column" style="width:50%;">
<p><br></p>
<div class="fragment">
<p><img data-src="images/joins_setup2.png"></p>
</div>
</div></div>
</section>
<section id="semi_join" class="slide level2">
<h2><code>semi_join()</code></h2>

<img data-src="images/joins_semi.png" class="r-stretch quarto-figure-center"><p class="caption">Keeps all rows in x that have a match in y</p></section>
<section id="semi_join-in-nycflights13" class="slide level2">
<h2><code>semi_join()</code> in <code>nycflights13</code></h2>
<p>We could use a semi-join to filter the airports dataset to show just the origin airports.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a></a>airports <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a></a>  <span class="fu">semi_join</span>(flights2, <span class="fu">join_by</span>(faa <span class="sc">==</span> origin))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell fragment">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 8
  faa   name                  lat   lon   alt    tz dst   tzone           
  &lt;chr&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;           
1 EWR   Newark Liberty Intl  40.7 -74.2    18    -5 A     America/New_York
2 JFK   John F Kennedy Intl  40.6 -73.8    13    -5 A     America/New_York
3 LGA   La Guardia           40.8 -73.9    22    -5 A     America/New_York</code></pre>
</div>
</div>
</div>
</section>
<section id="anti_join" class="slide level2">
<h2><code>anti_join()</code></h2>

<img data-src="images/joins_anti.png" class="r-stretch quarto-figure-center"><p class="caption">Returns all rows in x that don’t have a match in y</p></section>
<section id="anti_join-in-nycflights13" class="slide level2">
<h2><code>anti_join()</code> in <code>nycflights13</code></h2>
<p>We can find rows that are missing from airports by looking for flights that don’t have a matching destination airport.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a></a>airports <span class="sc">|&gt;</span> </span>
<span id="cb83-2"><a></a>  <span class="fu">anti_join</span>(flights2, <span class="fu">join_by</span>(faa <span class="sc">==</span> origin))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell fragment">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,455 × 8
   faa   name                             lat    lon   alt    tz dst   tzone    
   &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    
 1 04G   Lansdowne Airport               41.1  -80.6  1044    -5 A     America/…
 2 06A   Moton Field Municipal Airport   32.5  -85.7   264    -6 A     America/…
 3 06C   Schaumburg Regional             42.0  -88.1   801    -6 A     America/…
 4 06N   Randall Airport                 41.4  -74.4   523    -5 A     America/…
 5 09J   Jekyll Island Airport           31.1  -81.4    11    -5 A     America/…
 6 0A9   Elizabethton Municipal Airport  36.4  -82.2  1593    -5 A     America/…
 7 0G6   Williams County Airport         41.5  -84.5   730    -5 A     America/…
 8 0G7   Finger Lakes Regional Airport   42.9  -76.8   492    -5 A     America/…
 9 0P2   Shoestring Aviation Airfield    39.8  -76.6  1000    -5 U     America/…
10 0S9   Jefferson County Intl           48.1 -123.    108    -8 A     America/…
# ℹ 1,445 more rows</code></pre>
</div>
</div>

</div>
<aside><div>
<p><span class="fragment">This type of join is useful for finding missing values that are implicit in the data (i.e.&nbsp;<code>NA</code>s that don’t show up in the data but only exist as an absence.)</span></p>
</div></aside></section>
<section id="more-than-one-match" class="slide level2">
<h2>More Than One Match</h2>

<img data-src="images/joins_match-types.png" class="quarto-figure quarto-figure-center r-stretch"><div class="fragment">
<p>There are three possible outcomes for a row in x:</p>
<ul>
<li class="fragment">If it doesn’t match anything, it’s dropped.</li>
<li class="fragment">If it matches 1 row in <code>y</code>, it’s preserved.</li>
<li class="fragment">If it matches more than 1 row in<code>y</code>, it’s duplicated once for each match.</li>
</ul>
</div>
<div class="fragment">
<p>What happens if we match on more than one row?</p>
</div>
</section>
<section id="more-than-one-match-1" class="slide level2">
<h2>More Than One Match</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a></a>df1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">key =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">val_x =</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>))</span>
<span id="cb85-2"><a></a>df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">key =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">val_y =</span> <span class="fu">c</span>(<span class="st">"y1"</span>, <span class="st">"y2"</span>, <span class="st">"y3"</span>))</span>
<span id="cb85-3"><a></a></span>
<span id="cb85-4"><a></a>df1 <span class="sc">|&gt;</span> </span>
<span id="cb85-5"><a></a>  <span class="fu">inner_join</span>(df2, <span class="fu">join_by</span>(key))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell fragment">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inner_join(df1, df2, join_by(key)): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 2 of `x` matches multiple rows in `y`.
ℹ Row 2 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
    key val_x val_y
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
1     1 x1    y1   
2     2 x2    y2   
3     2 x2    y3   
4     2 x3    y2   
5     2 x3    y3   </code></pre>
</div>
</div>

<aside><div>
<div class="r-stack">
<p><span class="fragment fade-in-then-out">If you are doing this deliberately, you can set <code>relationship = "many-to-many"</code>, as the warning suggests.</span></p>
<p><span class="fragment">Note: Given their nature, <em>filtering</em> joins never duplicate rows like mutating joins do. They will only ever return a subset of the datasets.</span></p>
</div>
</div></aside></section>
<section id="non-equi-joins" class="slide level2">
<h2>Non-Equi Joins</h2>
<p>The joins we’ve discussed thus far have all been equi-joins, where the rows match if the x key equals the y key. But you can also specify other types of relationships.</p>
<div class="fragment">
<p><code>dplyr</code> has four different types of non-equi joins:</p>
</div>
<div class="fragment">
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><strong>Cross joins</strong> match every pair of rows.</li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="images/joins_cross.png" class="absolute" style="top: 150px; right: 150px; width: 25%; "></p>
</div></div>

</div>
<aside><div>
<p><span class="fragment">Cross joins, aka self-joins, are useful when generating permutations (e.g.&nbsp;creating every possible combination of values). This comes in handy when creating datasets of predicted probabilities for plotting in ggplot.</span></p>
</div></aside></section>
<section id="non-equi-joins-1" class="slide level2">
<h2>Non-Equi Joins</h2>
<p>The joins we’ve discussed thus far have all been equi-joins, where the rows match if the x key equals the y key. But you can also specify other types of relationships.</p>
<p><code>dplyr</code> has four different types of non-equi joins:</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><strong>Cross joins</strong> match every pair of rows.</li>
<li><strong>Inequality joins</strong> use &lt;, &lt;=, &gt;, and &gt;= instead of ==.
<ul>
<li><strong>Overlap joins</strong> are a special type of inequality join designed to work with ranges<sup>1</sup>.</li>
</ul></li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="images/joins_inequality.png" class="absolute" style="top: 158px; right: 120px; width: 30%; "></p>
</div></div>

<aside><div>
<p>Inequality joins can be used to restrict the cross join so that instead of generating all permutations, we generate all combinations.</p>
</div><ol class="aside-footnotes"><li id="fn9"><p>Overlap joins provide three helpers that use inequality joins to make it easier to work with intervals: <code>between()</code>, <code>within()</code>, <code>overlaps()</code>. Read more about their functionality and specifications <a href="https://dplyr.tidyverse.org/reference/join_by.html?q=within#overlap-joins">here</a>.</p></li></ol></aside></section>
<section id="non-equi-joins-2" class="slide level2">
<h2>Non-Equi Joins</h2>
<p>The joins we’ve discussed thus far have all been equi-joins, where the rows match if the x key equals the y key. But you can also specify other types of relationships.</p>
<p><code>dplyr</code> has four different types of non-equi joins:</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><strong>Cross joins</strong> match every pair of rows.</li>
<li><strong>Inequality joins</strong> use &lt;, &lt;=, &gt;, and &gt;= instead of ==.
<ul>
<li><strong>Overlap joins</strong> are a special type of inequality join designed to work with ranges.</li>
</ul></li>
<li><strong>Rolling joins</strong> are similar to inequality joins but only find the closest match.</li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="images/joins_rolling.png" class="absolute" style="top: 155px; right: 35px; width: 42%; "></p>
</div></div>

<aside><div>
<p>Rolling joins are a special type of inequality join where instead of getting every row that satisfies the inequality, you get just the closest row. You can turn any inequality join into a rolling join by adding closest().</p>
</div></aside></section></section>
<section>
<section id="homework" class="title-slide slide level1 section-title center" data-background-color="#1e4655">
<h1>Homework</h1>

</section>
<section id="section-1" class="slide level2" data-menu-title="Homework 4" data-background-iframe="https://vsass.github.io/CSSS508/Homework/HW4/homework4.html" data-background-interactive="TRUE">
<h2></h2>


</section></section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-pointer/pointer.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'pointer': {"key":"q","color":"#b18eb1","pointerSize":16,"alwaysVisible":false},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, RevealPointer, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
                // default icon
                link.classList.add("external");
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
            let selectedAnnoteEl;
            const selectorForAnnotation = ( cell, annotation) => {
              let cellAttr = 'data-code-cell="' + cell + '"';
              let lineAttr = 'data-code-annotation="' +  annotation + '"';
              const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
              return selector;
            }
            const selectCodeLines = (annoteEl) => {
              const doc = window.document;
              const targetCell = annoteEl.getAttribute("data-target-cell");
              const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
              const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              const lines = annoteSpan.getAttribute("data-code-lines").split(",");
              const lineIds = lines.map((line) => {
                return targetCell + "-" + line;
              })
              let top = null;
              let height = null;
              let parent = null;
              if (lineIds.length > 0) {
                  //compute the position of the single el (top and bottom and make a div)
                  const el = window.document.getElementById(lineIds[0]);
                  top = el.offsetTop;
                  height = el.offsetHeight;
                  parent = el.parentElement.parentElement;
                if (lineIds.length > 1) {
                  const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                  const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                  height = bottom - top;
                }
                if (top !== null && height !== null && parent !== null) {
                  // cook up a div (if necessary) and position it 
                  let div = window.document.getElementById("code-annotation-line-highlight");
                  if (div === null) {
                    div = window.document.createElement("div");
                    div.setAttribute("id", "code-annotation-line-highlight");
                    div.style.position = 'absolute';
                    parent.appendChild(div);
                  }
                  div.style.top = top - 2 + "px";
                  div.style.height = height + 4 + "px";
                  div.style.left = 0;
                  let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                  if (gutterDiv === null) {
                    gutterDiv = window.document.createElement("div");
                    gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                    gutterDiv.style.position = 'absolute';
                    const codeCell = window.document.getElementById(targetCell);
                    const gutter = codeCell.querySelector('.code-annotation-gutter');
                    gutter.appendChild(gutterDiv);
                  }
                  gutterDiv.style.top = top - 2 + "px";
                  gutterDiv.style.height = height + 4 + "px";
                }
                selectedAnnoteEl = annoteEl;
              }
            };
            const unselectCodeLines = () => {
              const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
              elementsIds.forEach((elId) => {
                const div = window.document.getElementById(elId);
                if (div) {
                  div.remove();
                }
              });
              selectedAnnoteEl = undefined;
            };
              // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
          let throttle = false;
          let timer;
            return (...args) => {
              if(!throttle) { // first call gets through
                  fn.apply(this, args);
                  throttle = true;
              } else { // all the others get throttled
                  if(timer) clearTimeout(timer); // cancel #2
                  timer = setTimeout(() => {
                    fn.apply(this, args);
                    timer = throttle = false;
                  }, ms);
              }
            };
          }
            const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
            for (let i=0; i<annoteTargets.length; i++) {
              const annoteTarget = annoteTargets[i];
              const targetCell = annoteTarget.getAttribute("data-target-cell");
              const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
              const contentFn = () => {
                const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
                if (content) {
                  const tipContent = content.cloneNode(true);
                  tipContent.classList.add("code-annotation-tip-content");
                  return tipContent.outerHTML;
                }
              }
              const config = {
                allowHTML: true,
                content: contentFn,
                onShow: (instance) => {
                  selectCodeLines(instance.reference);
                  instance.reference.classList.add('code-annotation-active');
                  window.tippy.hideAll();
                },
                onHide: (instance) => {
                  unselectCodeLines();
                  instance.reference.classList.remove('code-annotation-active');
                },
                maxWidth: 300,
                delay: [50, 0],
                duration: [200, 0],
                offset: [5, 10],
                arrow: true,
                appendTo: function(el) {
                  return el.parentElement.parentElement.parentElement;
                },
                interactive: true,
                interactiveBorder: 10,
                theme: 'light-border',
                placement: 'right',
                popperOptions: {
                  modifiers: [
                  {
                    name: 'flip',
                    options: {
                      flipVariations: false, // true by default
                      allowedAutoPlacements: ['right'],
                      fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                    },
                  },
                  {
                    name: 'preventOverflow',
                    options: {
                      mainAxis: false,
                      altAxis: false
                    }
                  }
                  ]        
                }      
              };
              window.tippy(annoteTarget, config); 
            }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>